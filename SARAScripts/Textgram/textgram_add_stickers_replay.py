# coding=utf8

import os
import sys
import time
import json
import frida
import argparse
import traceback
import uiautomator2 as u2
sys.path.append(os.path.abspath(os.getcwd()))
from script import util

frida_session = None
xml = None
view_hierarchy = None
save_path = None
action_count = 0
current_popup_window = None
curr_webview_address = None

d = u2.connect()
print(d.info)


def log(desc):
    global action_count
    print('[ReplayAction]-%d: ' % action_count, desc)


def error_handler(func):
    def wrapper(message, data):
        if message['type'] == 'error':
            print('[Func]: %s, [Error-msg]: %s' % (func.__name__, message))
            print('[Func]: %s, [Error-des]: %s' % (func.__name__, message['description']))
            print('[Func]: %s, [Error-sta]: %s' % (func.__name__, message['stack']))
            print('[Func]: %s, [Error-dat]: %s' % (func.__name__, data))
            return None
        else:
            return func(message, data)
    return wrapper


def preprocess_path():
    global save_path
    if save_path is None:
        return False
    if not os.path.exists(save_path):
        os.mkdir(save_path)
    else:
        for file in os.listdir(save_path):
            os.remove(os.path.join(save_path, file))
    return True


def post_action(custom_interval):
    global xml
    global d
    global action_count
    global save_path
    global view_hierarchy

    print('[ReplayTimeInterval]-%d: %s' % (action_count, json.dumps({'interval': custom_interval})))
    if action_count > 0:
        # time.sleep(1)
        if custom_interval > 0:
            time.sleep(custom_interval)
    xml = d.dump_hierarchy()
    xml = util.parse_xml(xml)
    screenshot_filename = os.path.join(save_path, '_'.join(['screenshot', str(action_count)]) + '.jpg')
    xml_filename = os.path.join(save_path, '_'.join(['ui', str(action_count)]) + '.xml')
    view_hierarchy_filename = os.path.join(save_path, '_'.join(['view_hierarchy', str(action_count)]) + '.xml')
    d.screenshot(screenshot_filename)
    util.save_xml(xml, xml_filename)
    view_hierarchy, lxml_view_hierarchy = util.dump_view_hierarchy(d, view_hierarchy_filename)
    action_count += 1


def set_text(rid, bounds, text):
    global xml
    view = util.find_view(rid, bounds, xml)
    if view is None:
        print('TextView ' + rid + ' does not exist')
    else:
        if len(rid) > 0:
            d(resourceId=rid, focused=True).set_text(text)
        else:
            d(focused=True).set_text(text)
        log('[set_text]-%s' % json.dumps({'rid': rid, 'text': text, 'bounds': bounds}))


def press_soft_keyboard(key_name):
    global xml
    index = util.find_soft_key(key_name, xml)
    if index is None:
        raise Exception('Key ' + key_name + ' does not exist')
    key_x, key_y = index[0], index[1]
    d.click(key_x, key_y)
    log('[press_key]-%s' % json.dumps({'key_name': key_name}))


def hide_soft_keyboard():
    global xml
    if util.check_soft_keyboard(xml):
        print('Hide soft keyboard')
        d.press('back')
        log('[hide_keyboard]')


def record_popup_window():
    global current_popup_window
    current_popup_window = util.get_current_window(d)
    log('[record_popup_window]-%s' % json.dumps({'window': current_popup_window}))


def close_popup_window():
    global current_popup_window
    if current_popup_window is not None:
        window = util.get_current_window(d)
        if window == current_popup_window:
            d.press('back')
            log('[hide_popup_window]-%s' % json.dumps({'window': current_popup_window}))
            current_popup_window = None


def clean_up():
    global frida_session
    print('Clean Up....')
    frida_session.detach()


def detect_webview():
    # Get WebView handle
    global frida_session
    instrument_script = frida_session.create_script(util.instrument_WebView())
    instrument_script.on('message', get_instrument_WebView_message)
    instrument_script.load()


@error_handler
def get_instrument_WebView_message(message, data):
    global curr_webview_address
    print('[WebView]: ', message)
    curr_webview_address = util.get_view_address(message['payload']['webview'])


def perform_click_event(tap_type, x, y, duration, view_type):
    global action_count
    global view_hierarchy
    global frida_session

    if view_type == 'Activity':
        candidates = util.find_component_candidates(view_hierarchy, x, y)
        # Instrument
        instrument_script = None
        code = util.instrument_view([candidate['classname'] for candidate in candidates], [candidate['address'] for candidate in candidates], action_count)
        instrument_script = frida_session.create_script(code)
        instrument_script.on('message', get_instrument_view_message)
        instrument_script.load()
        if tap_type == 'LongTap':
            d.long_click(x, y, duration)
        elif tap_type == 'Tap':
            d.long_click(x, y, duration)
        elif tap_type == 'DoubleTap':
            d.double_click(x, y, 0.1)

        # time.sleep(1)
        instrument_script.unload()
        log('[click]-%s' % json.dumps({'tap_type': tap_type, 'x': x, 'y': y, 'duration': duration, 'candidate': candidates, 'view_type': view_type}))

    else:
        # Dialog & PopupWindow
        # command `adb shell dumpsys activity top` fails to extract view hierarchy of Dialog & PopupWindow
        if tap_type == 'LongTap':
            d.long_click(x, y, duration)
        elif tap_type == 'Tap':
            d.long_click(x, y, duration)
        elif tap_type == 'DoubleTap':
            d.double_click(x, y, 0.1)
        log('[click]-%s' % json.dumps({'tap_type': tap_type, 'x': x, 'y': y, 'duration': duration, 'view_type': view_type}))


@error_handler
def get_instrument_view_message(message, data):
    print('[ReplayViewInstrumentation]: %s' % json.dumps(message))


def perform_swipe_event(pointers, duration=0.01):
    d.swipe_points(pointers, duration)
    log('[swipe]-%s' % json.dumps({'pointers': pointers, 'duration': duration}))


def perform_key_event(key_code):
    d.press(key_code)
    log('[press]-%s' % json.dumps({'key_code': key_code}))


def webview_set_text(input_selector, text, webview_classname, package_name):
    # Set Text
    global curr_webview_address
    code = util.webview_set_text(input_selector, text, webview_classname, curr_webview_address, package_name)
    instrument_script = frida_session.create_script(code)
    instrument_script.on('message', get_webview_set_text_message)
    instrument_script.load()


def webview_set_text_with_u2(text):
    d(focused=True).set_text(text)
    log('[webview_set_text]-%s' % json.dumps({'text': text}))


@error_handler
def get_webview_set_text_message(message, data):
    print('[WebViewSetText]: ', message)


def instrument_chrome_client():
    code = util.instrument_chrome_client()
    script = frida_session.create_script(code)
    script.on('message', get_instrument_chrome_client_message)
    script.load()


@error_handler
def get_instrument_chrome_client_message(message, data):
    print('[Console]: ', message)


if __name__ == '__main__':
    parser = argparse.ArgumentParser(description='Argument Parser')
    parser.add_argument('--path', help='save path', required=True)
    parser.add_argument('--package', help='package name', required=True)
    parser.add_argument('--pid', help='pid name', required=True)
    args = parser.parse_args()
    
    save_path = args.path
    package_name = args.package
    pid = int(args.pid)

    if not preprocess_path():
        print('Save path not found')
        sys.exit()

    # Setup Dynamic instrument   
    all_devices = frida.enumerate_devices()
    device = frida.get_usb_device()

    # Attach
    frida_session = device.attach(pid)
    print(frida_session)

    try:
        detect_webview()
        # instrument_chrome_client()
        post_action(0)

        perform_click_event("Tap", 605.159485, 207.837631, 0.112000, "Activity")
        post_action(0.780125)
        perform_click_event("Tap", 391.456329, 619.515991, 0.112000, "Activity")
        post_action(2.246710)
        perform_click_event("Tap", 393.453552, 1245.027344, 0.099000, "Activity")
        post_action(1.654148)
        perform_swipe_event([(581.1928100585938, 1081.1553955078125), (532.631103515625, 1078.7620849609375), (500.7300109863281, 1083.7491455078125), (468.39105224609375, 1093.2333984375), (403.1760559082031, 1109.183837890625), (380.1367492675781, 1114.9627685546875), (340.66912841796875, 1123.0870361328125), (320.6656188964844, 1126.2978515625), (290.6470642089844, 1131.1070556640625), (277.32470703125, 1132.4014892578125), (263.2878112792969, 1134.5047607421875), (258.190185546875, 1135.1131591796875), (257.6421813964844, 1136.1124267578125), (256.3533020019531, 1136.1124267578125), (256.6435546875, 1136.1124267578125)], 0.031500)
        post_action(0.384214)
        perform_click_event("Tap", 703.023621, 1090.148315, 0.112000, "Activity")
        post_action(1.063702)
        perform_swipe_event([(554.230224609375, 891.3036499023438), (571.2066650390625, 680.1900024414062), (572.6096801757812, 639.6152954101562), (576.1668701171875, 574.978515625), (580.1941528320312, 538.5792236328125), (584.4761352539062, 511.2117614746094), (589.5944213867188, 485.5542297363281), (593.7430419921875, 467.6607360839844), (597.0042724609375, 454.477783203125), (598.2632446289062, 449.2726135253906), (599.5931396484375, 440.3782043457031), (600.1664428710938, 437.1584777832031), (600.1664428710938, 436.65887451171875), (601.664306640625, 429.16473388671875), (602.1636962890625, 422.8993225097656), (603.1622924804688, 420.3133239746094), (603.1622924804688, 417.1741027832031), (604.056396484375, 415.77978515625), (604.6267700195312, 415.2091064453125), (606.1876220703125, 415.6752624511719)], 0.033500)
        post_action(0.442731)
        perform_swipe_event([(457.3647766113281, 945.2615356445312), (455.3547668457031, 897.5166625976562), (459.39886474609375, 858.3551025390625), (465.9848327636719, 814.256591796875), (483.3923034667969, 744.1481323242188), (498.78863525390625, 695.2719116210938), (520.8111572265625, 624.972900390625), (542.642822265625, 549.984375), (552.9159545898438, 514.2730712890625), (564.7156982421875, 476.6276550292969), (575.9703979492188, 445.2032470703125), (592.087646484375, 407.3841857910156), (598.6685180664062, 390.69476318359375), (601.0576782226562, 388.0194396972656), (603.1622924804688, 380.10711669921875), (607.0526733398438, 373.46881103515625), (611.0972290039062, 362.93267822265625), (613.053466796875, 359.8615417480469), (614.364990234375, 358.501708984375), (615.1456298828125, 353.7236328125), (616.623779296875, 353.243896484375), (616.144287109375, 353.7236633300781)], 0.033000)
        post_action(0.449211)
        perform_swipe_event([(378.4743347167969, 946.2607421875), (381.15582275390625, 915.4053955078125), (387.6412353515625, 892.1913452148438), (394.39349365234375, 861.5618896484375), (406.92059326171875, 805.1306762695312), (422.9126281738281, 753.9110107421875), (436.28460693359375, 709.0711669921875), (445.37530517578125, 676.7442626953125), (459.55340576171875, 632.2543334960938), (469.96246337890625, 595.6891479492188), (478.06781005859375, 574.2665405273438), (491.0425720214844, 537.4064331054688), (499.82952880859375, 514.7545166015625), (513.0263061523438, 480.1471862792969), (520.8436889648438, 461.64935302734375), (531.540283203125, 442.5234375), (539.849853515625, 429.2938232421875), (552.2532348632812, 412.25360107421875), (557.7254028320312, 405.1834716796875), (559.0734252929688, 403.7596130371094), (559.2233276367188, 403.68463134765625), (560.221923828125, 403.68463134765625), (561.2205200195312, 403.68463134765625), (561.2205200195312, 404.683837890625)], 0.032500)
        post_action(0.600887)
        perform_swipe_event([(407.43414306640625, 879.3130493164062), (412.684326171875, 849.1060791015625), (426.015625, 791.9520874023438), (442.9822082519531, 732.2662963867188), (464.8543701171875, 666.9788818359375), (482.69854736328125, 614.2902221679688), (493.0546875, 586.323486328125), (506.5707092285156, 552.5128173828125), (520.208984375, 524.72705078125), (536.45068359375, 492.2239990234375), (547.70361328125, 473.43365478515625), (568.47021484375, 439.1745300292969), (576.5835571289062, 424.9953308105469), (590.6796875, 400.1873474121094), (601.3973999023438, 383.7964172363281), (610.6434936523438, 366.9432067871094), (620.259765625, 352.8555908203125), (624.0098266601562, 344.9775695800781), (624.1331787109375, 343.25115966796875), (625.1317749023438, 343.7314453125)], 0.033000)
        post_action(0.434882)
        perform_swipe_event([(552.2330322265625, 517.5956420898438), (543.1573486328125, 538.482421875), (524.9478759765625, 586.6646728515625), (496.45556640625, 662.8331298828125), (482.19464111328125, 703.0017700195312), (462.58953857421875, 776.4653930664062), (450.873779296875, 843.8406982421875), (446.2779541015625, 891.2236328125), (443.216796875, 919.1257934570312), (441.8476867675781, 930.5820922851562), (440.38836669921875, 953.1008911132812), (440.38836669921875, 964.6078491210938), (438.3911437988281, 986.4694213867188), (437.39251708984375, 1005.191650390625), (437.39251708984375, 1016.4112548828125), (436.3939208984375, 1021.6568603515625), (436.3939208984375, 1027.197509765625), (437.39251708984375, 1026.1982421875)], 0.033000)
        post_action(0.400728)
        perform_swipe_event([(554.230224609375, 401.6861877441406), (548.2739868164062, 425.5256652832031), (539.8365478515625, 460.2952880859375), (509.045166015625, 551.447509765625), (491.9073181152344, 603.3253784179688), (471.062744140625, 684.469970703125), (457.7930603027344, 761.973876953125), (450.1112976074219, 827.2527465820312), (448.1314697265625, 842.3111572265625), (447.378662109375, 865.463623046875), (446.3800354003906, 872.2288818359375), (446.3800354003906, 873.6089477539062), (446.3800354003906, 874.6630859375), (446.3800354003906, 881.2035522460938), (445.4034118652344, 884.2431640625), (445.3814392089844, 889.3052368164062)], 0.033000)
        post_action(0.446881)
        perform_swipe_event([(577.1983642578125, 423.66900634765625), (563.7171020507812, 458.14208984375), (541.6902465820312, 510.9142761230469), (529.3729858398438, 542.8946533203125), (510.7905578613281, 595.03515625), (500.6310119628906, 636.76220703125), (491.03521728515625, 668.3827514648438), (478.8349609375, 714.94140625), (467.91107177734375, 756.8845825195312), (462.6936950683594, 775.716796875), (459.0802917480469, 794.3541259765625), (457.3647766113281, 800.2573852539062), (457.3647766113281, 800.3746948242188), (457.3647766113281, 798.5752563476562), (457.3647766113281, 791.350830078125), (463.85577392578125, 745.4176025390625), (481.0002136230469, 682.0331420898438), (501.4808349609375, 634.6051635742188), (516.3809814453125, 607.3292236328125), (523.8074340820312, 589.4696655273438), (528.6871337890625, 580.2823486328125), (530.2635498046875, 578.5480346679688)], 0.033000)
        post_action(0.454274)
        perform_click_event("Tap", 134.812759, 823.356750, 0.112000, "Dialog")
        post_action(2.002218)
        perform_click_event("Tap", 150.790573, 345.729889, 0.141000, "Activity")
        post_action(1.152251)
        perform_swipe_event([(189.73648071289062, 417.6737060546875), (205.68832397460938, 433.63525390625), (207.8548583984375, 437.8493347167969), (216.05674743652344, 448.79180908203125), (227.0765380859375, 460.0325012207031), (223.6893310546875, 456.64324951171875), (239.41969299316406, 471.4148864746094), (244.16297912597656, 475.0054626464844), (255.79331970214844, 484.3404846191406), (261.98248291015625, 488.6260681152344), (273.27569580078125, 496.3536682128906), (281.67218017578125, 503.6698913574219), (290.3951416015625, 510.00079345703125), (297.291748046875, 514.4995727539062), (300.0730285644531, 517.0858764648438), (303.8858642578125, 520.2474975585938), (307.6942443847656, 524.8331298828125), (312.4100341796875, 529.4302978515625), (317.6957092285156, 535.7184448242188), (323.2535400390625, 543.278076171875), (327.15716552734375, 546.8785400390625), (330.4329833984375, 552.352294921875), (332.53814697265625, 554.7330932617188), (333.5367736816406, 556.0655517578125)], 0.033000)
        post_action(1.047978)
        perform_swipe_event([(324.54925537109375, 562.5604858398438), (311.5672607421875, 547.5722045898438), (302.5797424316406, 537.5800170898438), (280.0636901855469, 510.8719787597656), (264.94732666015625, 491.7355041503906), (252.14979553222656, 476.6276550292969), (243.9022979736328, 467.8755187988281), (239.51373291015625, 463.48431396484375), (237.66990661621094, 459.0093994140625), (236.7866668701172, 456.64324951171875), (236.67129516601562, 455.6440124511719), (235.9923095703125, 452.9661865234375), (234.7763671875, 451.74951171875), (234.674072265625, 450.4857177734375), (233.1761474609375, 449.14910888671875)], 0.033000)
        post_action(0.666441)
        perform_swipe_event([(180.74896240234375, 421.6705627441406), (239.490966796875, 417.8316345214844), (288.7908935546875, 409.46337890625), (315.0624084472656, 407.181884765625), (345.639892578125, 404.7514953613281), (360.68719482421875, 403.59332275390625), (384.4327697753906, 402.6853942871094), (404.9376220703125, 399.1881408691406), (419.3133544921875, 396.9107666015625), (441.4545593261719, 394.35107421875), (455.290283203125, 391.99053955078125), (468.8327941894531, 390.69476318359375), (477.63323974609375, 389.5104675292969), (491.8169250488281, 387.197509765625), (508.393310546875, 384.6852722167969), (515.2980346679688, 383.5314025878906), (527.711181640625, 380.2141418457031), (535.5595092773438, 378.9361877441406), (538.2244262695312, 378.7041320800781), (541.6819458007812, 378.7041320800781), (542.2468872070312, 379.1849060058594), (544.2274169921875, 379.703369140625), (547.5043334960938, 379.703369140625), (548.7671508789062, 380.70257568359375), (552.0072021484375, 381.7017822265625), (553.337158203125, 382.8066101074219), (556.660400390625, 383.91680908203125), (558.3991088867188, 385.28631591796875), (562.0413818359375, 386.52001953125), (564.3427734375, 387.7603759765625), (570.6887817382812, 390.18896484375), (572.8964233398438, 390.69476318359375), (577.2471313476562, 391.7427978515625), (579.195556640625, 393.0414733886719), (580.1942138671875, 395.1912841796875), (582.3486328125, 397.8466491699219), (582.19140625, 398.9798889160156), (582.19140625, 401.3270568847656), (582.19140625, 402.5259094238281), (582.19140625, 404.16436767578125), (582.19140625, 404.683837890625), (583.6493530273438, 407.1419372558594), (582.117919921875, 411.82537841796875), (582.19140625, 415.93170166015625), (582.19140625, 429.664306640625), (579.526611328125, 441.67144775390625), (574.8370971679688, 466.64019775390625), (571.2799682617188, 479.023193359375), (564.91796875, 500.44744873046875), (560.4902954101562, 516.6558227539062), (557.9907836914062, 527.6417236328125), (552.2330322265625, 550.0703125), (552.2330322265625, 558.3212280273438), (552.2330322265625, 579.157470703125), (551.1769409179688, 591.2289428710938), (548.7379150390625, 628.0093383789062), (544.9330444335938, 644.3572387695312), (542.2468872070312, 674.0438842773438), (540.9581909179688, 685.3693237304688), (541.248291015625, 697.455078125), (540.4180297851562, 699.9473876953125), (540.2496948242188, 702.5565185546875), (538.8148193359375, 703.8869018554688), (538.25244140625, 704.4496459960938)], 0.032500)
        post_action(0.646857)
        perform_swipe_event([(545.2427368164062, 677.470703125), (517.7581176757812, 683.6806640625), (481.47967529296875, 701.2650146484375), (452.6028137207031, 719.5632934570312), (415.1950988769531, 744.4360961914062), (395.43231201171875, 757.5628662109375), (367.5201110839844, 774.10302734375), (345.0764465332031, 788.297607421875), (323.0960693359375, 801.8037109375), (297.3011474609375, 814.4907836914062), (276.69256591796875, 824.8171997070312), (263.63385009765625, 833.3489990234375), (245.30184936523438, 844.3099975585938), (235.56130981445312, 852.1679077148438), (224.11915588378906, 859.1136474609375), (218.16128540039062, 862.6831665039062), (167.14007568359375, 824.1005859375), (164.91421508789062, 820.502197265625), (163.7725372314453, 817.919677734375), (161.29173278808594, 814.8790893554688), (159.84327697753906, 812.4306030273438), (156.5994110107422, 809.1847534179688), (155.78363037109375, 806.5303344726562), (153.36134338378906, 801.9478149414062), (151.86900329589844, 799.5352172851562), (148.4210205078125, 794.6334838867188), (147.4702911376953, 792.7308959960938), (144.87246704101562, 788.4577026367188), (144.79888916015625, 786.4999389648438), (142.3023681640625, 784.8868408203125), (141.8030548095703, 782.6622314453125), (140.30514526367188, 780.889892578125), (140.804443359375, 780.3903198242188), (139.3065185546875, 780.3903198242188), (141.64317321777344, 780.3903198242188), (143.779052734375, 781.3895263671875), (149.29266357421875, 785.386474609375), (155.43978881835938, 788.0400390625), (159.34423828125, 791.9468383789062), (162.4153289794922, 792.3809204101562), (163.6390380859375, 793.3801879882812), (163.7725372314453, 794.8790283203125), (164.77114868164062, 794.37939453125), (164.77114868164062, 795.3786010742188), (166.25286865234375, 795.3786010742188), (166.7683868408203, 796.3778076171875), (167.76699829101562, 797.3770751953125), (168.9832000732422, 798.3762817382812), (169.76422119140625, 799.37548828125), (170.76283264160156, 800.417724609375), (171.76144409179688, 801.3739013671875), (172.7600555419922, 802.3731689453125)], 0.033000)
        post_action(3.803254)
        perform_click_event("Tap", 39.944523, 1236.034302, 0.086000, "Activity")
        post_action(1.337838)
        perform_click_event("Tap", 394.452148, 1243.028931, 0.087000, "Activity")
        post_action(1.649984)
        perform_click_event("Tap", 691.040222, 1093.145996, 0.111000, "Activity")
        post_action(0.847635)
        perform_swipe_event([(528.2662963867188, 903.2943115234375), (526.2691040039062, 865.1488647460938), (530.6041259765625, 822.2880859375), (537.0509643554688, 781.608154296875), (543.0216674804688, 737.4412231445312), (544.9295654296875, 721.6021118164062), (546.748291015625, 698.6390380859375), (550.13671875, 667.1234130859375), (551.4764404296875, 651.5830688476562), (557.7254028320312, 619.5159912109375), (570.5230712890625, 566.2327270507812), (576.2415161132812, 540.9931030273438), (583.6893310546875, 506.1045837402344), (596.9996337890625, 467.7578125), (602.3274536132812, 452.1547546386719), (612.0332641601562, 431.8959655761719), (617.1598510742188, 423.0388488769531), (623.5014038085938, 410.1031494140625), (636.0336303710938, 394.7745666503906), (639.8823852539062, 390.92352294921875), (644.604736328125, 380.20294189453125), (654.1461181640625, 360.7664489746094), (660.9268188476562, 347.03948974609375), (664.5950317382812, 335.4428405761719), (667.0735473632812, 328.01416015625), (669.0707397460938, 324.5943908691406), (669.0707397460938, 324.74627685546875)], 0.033000)
        post_action(1.467723)
        perform_swipe_event([(563.2177734375, 876.3153686523438), (551.9259033203125, 833.349853515625), (551.2344360351562, 808.1910400390625), (554.91650390625, 775.4275512695312), (562.9620971679688, 730.2218627929688), (569.6950073242188, 702.9921264648438), (579.654296875, 674.0951538085938), (586.4774169921875, 649.1862182617188), (590.7520141601562, 640.997314453125), (599.7874145507812, 618.4277954101562), (607.25146484375, 597.9781494140625), (612.5816650390625, 583.9625854492188), (614.9609985351562, 578.9175415039062), (616.144287109375, 574.17578125), (617.1428833007812, 573.0345458984375), (617.1428833007812, 571.5650634765625), (618.1414794921875, 570.4306640625), (618.1414794921875, 570.5542602539062), (618.1414794921875, 569.5550537109375), (618.1414794921875, 568.288818359375)], 0.033000)
        post_action(0.853012)
        perform_click_event("Tap", 452.371704, 688.462158, 0.085000, "Dialog")
        post_action(1.238224)
        perform_swipe_event([(133.81414794921875, 355.7220764160156), (157.32444763183594, 370.27581787109375), (181.74758911132812, 373.20843505859375), (218.30416870117188, 372.60845947265625), (236.5230712890625, 371.46905517578125), (278.11376953125, 364.2154541015625), (301.91656494140625, 359.3299560546875), (334.3401794433594, 355.6646423339844), (350.2680358886719, 355.7220764160156), (368.9129638671875, 355.7220764160156), (380.587890625, 355.7220764160156), (402.88226318359375, 354.7228698730469), (418.7164611816406, 353.36578369140625), (442.8848876953125, 352.72442626953125), (464.4739990234375, 350.7259826660156), (479.0155944824219, 349.7267761230469), (494.39556884765625, 348.7275695800781), (510.46478271484375, 346.58251953125), (526.7684326171875, 344.2310791015625), (540.071533203125, 341.7686767578125), (547.689453125, 340.621337890625), (552.90576171875, 341.4069519042969), (556.165283203125, 341.7330322265625), (558.60693359375, 341.7330322265625), (561.9729614257812, 341.7330322265625), (564.1202392578125, 341.7330322265625), (565.4453735351562, 341.7330322265625), (568.7100830078125, 341.7330322265625), (569.9401245117188, 341.7330322265625), (573.4042358398438, 341.7330322265625), (575.5675659179688, 342.91558837890625), (590.47607421875, 341.7330322265625), (597.6953735351562, 340.94427490234375), (609.5413208007812, 340.7337951660156), (612.5087280273438, 340.7337951660156), (615.9646606445312, 341.5533142089844), (617.1384887695312, 341.7330322265625), (617.6422119140625, 341.7330322265625), (619.639404296875, 342.73223876953125), (621.6901245117188, 342.73223876953125), (624.3665771484375, 343.7314453125), (624.1331787109375, 344.93560791015625), (626.0114135742188, 345.61083984375), (626.13037109375, 345.7298889160156), (627.1290283203125, 345.7298889160156), (627.1290283203125, 346.7291259765625), (628.1276245117188, 346.7291259765625), (628.1276245117188, 347.72833251953125), (629.126220703125, 347.72833251953125), (629.126220703125, 348.7275695800781), (628.1276245117188, 348.7275695800781)], 0.033000)
        post_action(6.184603)
        perform_click_event("Tap", 359.500702, 1249.024170, 0.112000, "Activity")
        post_action(2.753345)
        perform_swipe_event([(626.13037109375, 1110.1326904296875), (604.160888671875, 1105.1365966796875), (587.0209350585938, 1105.1365966796875), (566.9927368164062, 1107.492431640625), (544.2310791015625, 1114.9342041015625), (523.0855102539062, 1122.761962890625), (502.3023681640625, 1129.117919921875), (488.2542724609375, 1133.4703369140625), (475.56256103515625, 1137.422119140625), (470.63983154296875, 1138.2520751953125), (462.2455749511719, 1141.81201171875), (457.4222717285156, 1143.078125), (454.8555908203125, 1144.106201171875), (449.2929382324219, 1145.466064453125), (442.4837951660156, 1147.0711669921875), (437.8560485839844, 1149.3699951171875), (432.39947509765625, 1151.600341796875), (426.2120056152344, 1153.197021484375), (420.4161071777344, 1155.0975341796875)], 0.033000)
        post_action(0.647005)
        perform_swipe_event([(423.41192626953125, 1116.1280517578125), (390.0584716796875, 1122.2408447265625), (368.59857177734375, 1126.4410400390625), (353.5090026855469, 1129.6175537109375), (338.85614013671875, 1131.1163330078125), (330.4195556640625, 1133.3388671875), (320.3086853027344, 1136.92333984375), (317.8764343261719, 1137.9520263671875), (310.0693359375, 1139.110107421875), (308.5714111328125, 1140.60888671875), (308.5714416503906, 1141.1085205078125)], 0.033000)
        post_action(1.216520)
        perform_click_event("Tap", 452.371704, 1238.032837, 0.112000, "Activity")
        post_action(1.399441)
        perform_swipe_event([(252.64910888671875, 1235.03515625), (285.51678466796875, 1223.57666015625), (324.7661437988281, 1214.0032958984375), (370.6074523925781, 1208.1536865234375), (432.3238220214844, 1207.0570068359375), (460.8789978027344, 1207.0570068359375), (470.715087890625, 1208.05615234375), (483.5035095214844, 1207.0570068359375), (493.0647277832031, 1206.0577392578125), (495.31207275390625, 1206.0577392578125), (496.3106994628906, 1205.05859375)], 0.033000)
        post_action(0.553301)
        perform_click_event("Tap", 351.511810, 1233.036743, 0.085000, "Activity")
        post_action(1.447189)
        perform_click_event("Tap", 150.790573, 1229.039795, 0.082000, "Activity")
        post_action(2.300322)
        perform_click_event("Tap", 212.704575, 1136.112427, 0.095000, "Activity")
        post_action(2.039089)
        perform_click_event("Tap", 70.901527, 1247.025757, 0.099000, "Activity")
        post_action(1.301636)
        perform_click_event("Tap", 67.905685, 92.927399, 0.088000, "Activity")
        post_action(0.916377)
        perform_click_event("Tap", 570.208069, 743.419189, 0.082000, "Dialog")
        post_action(1.615338)
        perform_click_event("Tap", 229.681000, 202.841522, 0.085000, "Activity")
        post_action(0.000000)

    except Exception as e:
        print(e)
        traceback_str = ''.join(traceback.format_tb(e.__traceback__))
        print(traceback_str)
    clean_up()
    