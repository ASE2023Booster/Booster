# coding=utf8

import os
import sys
import time
import json
import frida
import argparse
import traceback
import uiautomator2 as u2
sys.path.append(os.path.abspath(os.getcwd()))
from script import util

frida_session = None
xml = None
view_hierarchy = None
save_path = None
action_count = 0
current_popup_window = None
curr_webview_address = None

d = u2.connect()
print(d.info)


def log(desc):
    global action_count
    print('[ReplayAction]-%d: ' % action_count, desc)


def error_handler(func):
    def wrapper(message, data):
        if message['type'] == 'error':
            print('[Func]: %s, [Error-msg]: %s' % (func.__name__, message))
            print('[Func]: %s, [Error-des]: %s' % (func.__name__, message['description']))
            print('[Func]: %s, [Error-sta]: %s' % (func.__name__, message['stack']))
            print('[Func]: %s, [Error-dat]: %s' % (func.__name__, data))
            return None
        else:
            return func(message, data)
    return wrapper


def preprocess_path():
    global save_path
    if save_path is None:
        return False
    if not os.path.exists(save_path):
        os.mkdir(save_path)
    else:
        for file in os.listdir(save_path):
            os.remove(os.path.join(save_path, file))
    return True


def post_action(custom_interval):
    global xml
    global d
    global action_count
    global save_path
    global view_hierarchy

    print('[ReplayTimeInterval]-%d: %s' % (action_count, json.dumps({'interval': custom_interval})))
    if action_count > 0:
        # time.sleep(1)
        if custom_interval > 0:
            time.sleep(custom_interval)
    xml = d.dump_hierarchy()
    xml = util.parse_xml(xml)
    screenshot_filename = os.path.join(save_path, '_'.join(['screenshot', str(action_count)]) + '.jpg')
    xml_filename = os.path.join(save_path, '_'.join(['ui', str(action_count)]) + '.xml')
    view_hierarchy_filename = os.path.join(save_path, '_'.join(['view_hierarchy', str(action_count)]) + '.xml')
    d.screenshot(screenshot_filename)
    util.save_xml(xml, xml_filename)
    view_hierarchy, lxml_view_hierarchy = util.dump_view_hierarchy(d, view_hierarchy_filename)
    action_count += 1


def set_text(rid, bounds, text):
    global xml
    view = util.find_view(rid, bounds, xml)
    if view is None:
        print('TextView ' + rid + ' does not exist')
    else:
        if len(rid) > 0:
            d(resourceId=rid, focused=True).set_text(text)
        else:
            d(focused=True).set_text(text)
        log('[set_text]-%s' % json.dumps({'rid': rid, 'text': text, 'bounds': bounds}))


def press_soft_keyboard(key_name):
    global xml
    index = util.find_soft_key(key_name, xml)
    if index is None:
        raise Exception('Key ' + key_name + ' does not exist')
    key_x, key_y = index[0], index[1]
    d.click(key_x, key_y)
    log('[press_key]-%s' % json.dumps({'key_name': key_name}))


def hide_soft_keyboard():
    global xml
    if util.check_soft_keyboard(xml):
        print('Hide soft keyboard')
        d.press('back')
        log('[hide_keyboard]')


def record_popup_window():
    global current_popup_window
    current_popup_window = util.get_current_window(d)
    log('[record_popup_window]-%s' % json.dumps({'window': current_popup_window}))


def close_popup_window():
    global current_popup_window
    if current_popup_window is not None:
        window = util.get_current_window(d)
        if window == current_popup_window:
            d.press('back')
            log('[hide_popup_window]-%s' % json.dumps({'window': current_popup_window}))
            current_popup_window = None


def clean_up():
    global frida_session
    print('Clean Up....')
    frida_session.detach()


def detect_webview():
    # Get WebView handle
    global frida_session
    instrument_script = frida_session.create_script(util.instrument_WebView())
    instrument_script.on('message', get_instrument_WebView_message)
    instrument_script.load()


@error_handler
def get_instrument_WebView_message(message, data):
    global curr_webview_address
    print('[WebView]: ', message)
    curr_webview_address = util.get_view_address(message['payload']['webview'])


def perform_click_event(tap_type, x, y, duration, view_type):
    global action_count
    global view_hierarchy
    global frida_session

    if view_type == 'Activity':
        candidates = util.find_component_candidates(view_hierarchy, x, y)
        # Instrument
        instrument_script = None
        code = util.instrument_view([candidate['classname'] for candidate in candidates], [candidate['address'] for candidate in candidates], action_count)
        instrument_script = frida_session.create_script(code)
        instrument_script.on('message', get_instrument_view_message)
        instrument_script.load()
        if tap_type == 'LongTap':
            d.long_click(x, y, duration)
        elif tap_type == 'Tap':
            d.long_click(x, y, duration)
        elif tap_type == 'DoubleTap':
            d.double_click(x, y, 0.1)

        # time.sleep(1)
        instrument_script.unload()
        log('[click]-%s' % json.dumps({'tap_type': tap_type, 'x': x, 'y': y, 'duration': duration, 'candidate': candidates, 'view_type': view_type}))

    else:
        # Dialog & PopupWindow
        # command `adb shell dumpsys activity top` fails to extract view hierarchy of Dialog & PopupWindow
        if tap_type == 'LongTap':
            d.long_click(x, y, duration)
        elif tap_type == 'Tap':
            d.long_click(x, y, duration)
        elif tap_type == 'DoubleTap':
            d.double_click(x, y, 0.1)
        log('[click]-%s' % json.dumps({'tap_type': tap_type, 'x': x, 'y': y, 'duration': duration, 'view_type': view_type}))


@error_handler
def get_instrument_view_message(message, data):
    print('[ReplayViewInstrumentation]: %s' % json.dumps(message))


def perform_swipe_event(pointers, duration=0.01):
    d.swipe_points(pointers, duration)
    log('[swipe]-%s' % json.dumps({'pointers': pointers, 'duration': duration}))


def perform_key_event(key_code):
    d.press(key_code)
    log('[press]-%s' % json.dumps({'key_code': key_code}))


def webview_set_text(input_selector, text, webview_classname, package_name):
    # Set Text
    global curr_webview_address
    code = util.webview_set_text(input_selector, text, webview_classname, curr_webview_address, package_name)
    instrument_script = frida_session.create_script(code)
    instrument_script.on('message', get_webview_set_text_message)
    instrument_script.load()


def webview_set_text_with_u2(text):
    d(focused=True).set_text(text)
    log('[webview_set_text]-%s' % json.dumps({'text': text}))


@error_handler
def get_webview_set_text_message(message, data):
    print('[WebViewSetText]: ', message)


def instrument_chrome_client():
    code = util.instrument_chrome_client()
    script = frida_session.create_script(code)
    script.on('message', get_instrument_chrome_client_message)
    script.load()


@error_handler
def get_instrument_chrome_client_message(message, data):
    print('[Console]: ', message)


if __name__ == '__main__':
    parser = argparse.ArgumentParser(description='Argument Parser')
    parser.add_argument('--path', help='save path', required=True)
    parser.add_argument('--package', help='package name', required=True)
    parser.add_argument('--pid', help='pid name', required=True)
    args = parser.parse_args()
    
    save_path = args.path
    package_name = args.package
    pid = int(args.pid)

    if not preprocess_path():
        print('Save path not found')
        sys.exit()

    # Setup Dynamic instrument   
    all_devices = frida.enumerate_devices()
    device = frida.get_usb_device()

    # Attach
    frida_session = device.attach(pid)
    print(frida_session)

    try:
        detect_webview()
        # instrument_chrome_client()
        post_action(0)

        perform_click_event("Tap", 597.170593, 223.825134, 0.112000, "Activity")
        post_action(0.800633)
        perform_click_event("Tap", 390.457703, 678.469971, 0.067000, "Activity")
        post_action(2.670618)
        perform_click_event("Tap", 546.241333, 1224.043701, 0.068000, "Activity")
        post_action(1.300940)
        perform_click_event("Tap", 160.776703, 1115.128784, 0.068000, "Activity")
        post_action(1.685594)
        perform_click_event("Tap", 257.642181, 1109.133545, 0.055000, "Activity")
        post_action(1.570856)
        perform_swipe_event([(404.43829345703125, 1043.18505859375), (423.41192626953125, 1048.18115234375), (434.39666748046875, 1051.1787109375), (442.3855895996094, 1053.17724609375), (457.3647766113281, 1055.1756591796875), (467.3330383300781, 1054.180908203125), (476.9423522949219, 1053.056396484375), (482.1810607910156, 1052.177978515625), (491.22491455078125, 1052.177978515625), (496.0635070800781, 1052.177978515625), (503.45892333984375, 1052.177978515625), (506.5893859863281, 1051.747314453125), (515.0359497070312, 1051.1787109375), (519.0744018554688, 1051.1787109375), (529.7642211914062, 1051.1787109375), (534.7572631835938, 1051.1787109375), (546.3909912109375, 1050.1795654296875), (552.1778564453125, 1048.991455078125), (564.7042846679688, 1046.6845703125), (579.8453979492188, 1047.181884765625), (586.2064819335938, 1047.181884765625), (600.8057861328125, 1048.18115234375), (605.14501953125, 1047.181884765625), (614.0811767578125, 1047.181884765625), (617.1153564453125, 1046.1917724609375), (624.6324462890625, 1044.683837890625), (629.4337768554688, 1044.1842041015625), (635.4911499023438, 1043.18505859375), (641.60888671875, 1041.6861572265625), (648.7896118164062, 1042.185791015625), (654.9739990234375, 1041.1865234375), (660.038818359375, 1038.710693359375), (664.186767578125, 1038.18896484375), (669.94384765625, 1038.18896484375), (671.7699584960938, 1038.18896484375), (674.0638427734375, 1038.18896484375), (677.0596313476562, 1039.687744140625), (679.0006103515625, 1041.1583251953125), (681.0540771484375, 1042.462646484375), (682.5520629882812, 1042.185791015625), (684.0499267578125, 1044.1842041015625), (682.052734375, 1044.1842041015625), (682.052734375, 1045.68310546875), (679.0816650390625, 1045.1834716796875), (673.8473510742188, 1045.1834716796875), (663.0527954101562, 1046.1826171875), (655.349609375, 1047.181884765625), (646.6055297851562, 1049.5540771484375), (644.1154174804688, 1050.50927734375), (634.4458618164062, 1052.0963134765625), (623.1655883789062, 1054.3699951171875), (619.639404296875, 1054.1763916015625), (606.0546264648438, 1056.1748046875), (592.2714233398438, 1057.174072265625), (586.3983154296875, 1057.174072265625), (572.0203247070312, 1057.174072265625), (559.4567260742188, 1055.222412109375), (544.905517578125, 1055.1756591796875), (529.3096313476562, 1055.1756591796875), (511.8439636230469, 1057.1124267578125), (488.82110595703125, 1058.6729736328125), (467.35968017578125, 1061.1708984375), (444.862548828125, 1062.170166015625), (425.0973815917969, 1062.170166015625), (405.6996765136719, 1061.1708984375), (383.8258361816406, 1060.1717529296875), (367.30877685546875, 1057.8201904296875), (349.9443054199219, 1056.228515625), (342.8429870605469, 1055.22119140625), (323.55059814453125, 1052.677734375), (311.9894714355469, 1053.89208984375), (299.7223205566406, 1056.346923828125), (295.96636962890625, 1057.32958984375), (283.0377197265625, 1058.8865966796875), (272.73553466796875, 1061.1480712890625), (261.9819641113281, 1063.5826416015625), (254.30567932128906, 1064.1685791015625), (248.73324584960938, 1065.1678466796875), (243.66159057617188, 1065.1678466796875), (238.4927520751953, 1064.1685791015625), (234.3054656982422, 1064.1685791015625), (228.18307495117188, 1063.16943359375), (224.155517578125, 1063.16943359375), (219.0634307861328, 1063.16943359375), (217.3302764892578, 1062.170166015625), (215.71987915039062, 1062.170166015625), (214.70181274414062, 1062.170166015625), (216.4294891357422, 1062.170166015625), (218.68495178222656, 1062.170166015625), (226.35865783691406, 1062.170166015625), (244.76658630371094, 1061.1708984375), (255.34262084960938, 1061.1708984375), (272.4236755371094, 1061.1708984375), (286.6019287109375, 1061.1708984375), (300.8632507324219, 1061.1708984375), (316.6845703125, 1061.1708984375), (339.8960266113281, 1060.1717529296875), (360.2020568847656, 1060.1717529296875), (374.63818359375, 1060.1717529296875), (394.8876953125, 1060.1717529296875), (414.98846435546875, 1058.2354736328125), (421.0916442871094, 1058.17333984375), (440.38836669921875, 1057.174072265625), (455.3146667480469, 1055.1756591796875), (470.3553161621094, 1054.1763916015625), (482.7438659667969, 1053.17724609375), (495.80364990234375, 1052.177978515625), (512.3026733398438, 1052.177978515625), (525.354248046875, 1053.17724609375), (541.93994140625, 1053.17724609375), (557.751220703125, 1053.17724609375), (572.70458984375, 1053.17724609375), (589.4408569335938, 1051.1417236328125), (602.1354370117188, 1050.1795654296875), (614.0775756835938, 1048.4483642578125), (621.1232299804688, 1047.1865234375), (623.5638427734375, 1045.7529296875), (627.9000854492188, 1045.1834716796875), (631.1041259765625, 1044.1842041015625), (637.1151123046875, 1041.6861572265625), (640.3080444335938, 1041.5875244140625), (644.10546875, 1041.1865234375), (645.1040649414062, 1040.1873779296875), (646.9880981445312, 1040.1873779296875), (647.1012573242188, 1040.1873779296875)], 0.033000)
        post_action(0.515426)
        perform_click_event("Tap", 331.539551, 1128.118652, 0.099000, "Activity")
        post_action(1.453198)
        perform_swipe_event([(636.1165161132812, 1034.1920166015625), (612.1497802734375, 1034.1920166015625), (601.1304321289062, 1033.273193359375), (575.3893432617188, 1032.193603515625), (558.4653930664062, 1031.1943359375), (544.944091796875, 1031.1943359375), (530.8738403320312, 1030.1951904296875), (519.5000610351562, 1028.9984130859375), (498.8072509765625, 1029.1959228515625), (479.1138916015625, 1026.170654296875), (460.9552917480469, 1024.0439453125), (450.7139587402344, 1023.6824340820312), (430.4775085449219, 1023.2006225585938), (411.1131286621094, 1021.870849609375), (395.7093811035156, 1022.201416015625), (377.5137939453125, 1022.201416015625), (370.49853515625, 1022.201416015625), (355.0069580078125, 1022.201416015625), (336.8989562988281, 1023.2006225585938), (325.36279296875, 1023.2006225585938), (311.13055419921875, 1023.2006225585938), (295.4897766113281, 1023.2006225585938), (291.1478576660156, 1023.2006225585938), (283.4197082519531, 1023.2006225585938), (278.3572692871094, 1023.2006225585938), (276.65667724609375, 1023.2006225585938), (272.3953857421875, 1023.2006225585938), (271.17877197265625, 1023.2006225585938), (269.126220703125, 1022.201416015625), (269.6255187988281, 1022.201416015625), (273.4953308105469, 1022.201416015625), (283.91876220703125, 1023.2006225585938), (300.0832214355469, 1024.1998291015625), (318.2035827636719, 1027.2896728515625), (332.04901123046875, 1027.197509765625), (355.5172119140625, 1029.9964599609375), (378.30804443359375, 1032.269287109375), (405.93621826171875, 1032.193603515625), (437.084716796875, 1032.193603515625), (463.086181640625, 1031.133544921875), (489.32037353515625, 1026.1982421875), (513.1618041992188, 1022.3263549804688), (534.279296875, 1019.8674926757812), (549.4061279296875, 1019.2037353515625), (561.77001953125, 1019.2037353515625), (569.274658203125, 1018.2045288085938), (583.1900634765625, 1018.2045288085938), (599.069580078125, 1017.205322265625), (609.8905639648438, 1017.205322265625), (620.8814697265625, 1017.205322265625), (627.01611328125, 1018.2045288085938), (631.8963012695312, 1018.2045288085938), (633.1206665039062, 1019.2037353515625)], 0.033000)
        post_action(0.384732)
        perform_swipe_event([(484.32733154296875, 1130.1170654296875), (453.2501220703125, 1122.654052734375), (435.89459228515625, 1118.12646484375), (413.954833984375, 1113.995361328125), (403.6031799316406, 1112.926513671875), (382.4687805175781, 1112.131103515625), (370.8866882324219, 1112.131103515625), (350.3872985839844, 1111.117919921875), (334.2707824707031, 1111.1319580078125), (312.1585998535156, 1110.1326904296875), (298.0635070800781, 1111.1319580078125), (278.4566345214844, 1111.1319580078125), (268.153076171875, 1111.1319580078125), (251.15118408203125, 1111.1319580078125), (239.1624755859375, 1111.1319580078125), (222.83970642089844, 1111.1319580078125), (217.2177734375, 1111.1319580078125), (205.41342163085938, 1110.1326904296875), (202.1614227294922, 1110.1326904296875), (198.28558349609375, 1110.1326904296875), (197.22607421875, 1110.1326904296875), (196.2646484375, 1110.1326904296875), (195.72816467285156, 1111.1319580078125)], 0.030500)
        post_action(0.566045)
        perform_click_event("Tap", 347.517334, 1113.130371, 0.069000, "Activity")
        post_action(1.301422)
        perform_click_event("Tap", 451.373108, 1127.119385, 0.070000, "Activity")
        post_action(1.431920)
        perform_swipe_event([(610.152587890625, 1042.185791015625), (590.1802978515625, 1045.1834716796875), (579.195556640625, 1047.181884765625), (560.5848999023438, 1048.18115234375), (542.8222045898438, 1045.2794189453125), (527.3540649414062, 1041.35400390625), (507.74725341796875, 1035.803955078125), (500.7816467285156, 1034.287353515625), (484.8450622558594, 1034.1920166015625), (479.4435119628906, 1034.1920166015625), (461.1148376464844, 1035.096923828125), (454.8117370605469, 1036.1165771484375), (437.39251708984375, 1039.687744140625), (422.15826416015625, 1042.89453125), (416.279296875, 1044.2198486328125), (405.5907897949219, 1045.3525390625), (400.8671875, 1045.7083740234375), (394.9040832519531, 1046.1826171875), (392.44696044921875, 1047.1859130859375), (389.01446533203125, 1048.6260986328125), (388.4604797363281, 1048.18115234375), (387.46185302734375, 1048.18115234375), (386.4632568359375, 1048.18115234375), (384.96533203125, 1049.1802978515625), (384.4660339355469, 1049.1802978515625)], 0.033000)
        post_action(0.528504)
        perform_click_event("Tap", 255.644943, 1125.120972, 0.085000, "Activity")
        post_action(0.722991)
        perform_click_event("Tap", 527.267700, 1111.131958, 0.043000, "Activity")
        post_action(0.984223)
        perform_click_event("Tap", 628.127625, 1118.126465, 0.014000, "Activity")
        post_action(0.469483)
        perform_click_event("Tap", 619.140076, 1105.136597, 0.043000, "Activity")
        post_action(0.753897)
        perform_click_event("Tap", 612.149780, 1119.125732, 0.087000, "Activity")
        post_action(0.631697)
        perform_click_event("Tap", 701.026367, 1120.124878, 0.069000, "Activity")
        post_action(1.201237)
        perform_click_event("Tap", 594.174744, 666.479309, 0.067000, "Dialog")
        post_action(2.101768)
        perform_swipe_event([(542.2468872070312, 1107.135009765625), (512.2885131835938, 1111.1319580078125), (494.0975341796875, 1115.904296875), (457.1883544921875, 1124.623779296875), (436.7186584472656, 1124.596435546875), (396.5027160644531, 1111.3206787109375), (386.1888122558594, 1107.568115234375), (362.8292236328125, 1098.2530517578125), (354.3535461425781, 1096.4071044921875), (335.5286865234375, 1095.1444091796875), (326.32232666015625, 1095.1444091796875), (303.7262268066406, 1097.927490234375), (292.8778991699219, 1099.109619140625), (272.498291015625, 1102.6693115234375), (259.6393737792969, 1105.13671875), (241.54563903808594, 1106.9000244140625), (233.12811279296875, 1108.2255859375), (220.6775360107422, 1110.335693359375), (215.5423126220703, 1111.7105712890625), (208.2511444091797, 1113.9495849609375), (204.52178955078125, 1115.1934814453125), (198.7239990234375, 1116.627685546875), (196.72677612304688, 1117.0101318359375), (194.72955322265625, 1117.127197265625)], 0.034000)
        post_action(0.336316)
        perform_click_event("Tap", 645.104065, 1118.126465, 0.082000, "Activity")
        post_action(1.454190)
        perform_click_event("Tap", 463.356445, 1127.119385, 0.042000, "Activity")
        post_action(1.032136)
        perform_click_event("Tap", 384.466034, 1116.128052, 0.068000, "Activity")
        post_action(1.601415)
        perform_click_event("Tap", 70.901527, 1048.181152, 0.086000, "Activity")
        post_action(0.600597)
        perform_swipe_event([(162.77392578125, 1126.1202392578125), (190.0961456298828, 1127.4219970703125), (229.9895782470703, 1130.781982421875), (281.75213623046875, 1135.755615234375), (353.488525390625, 1138.5740966796875), (407.19384765625, 1139.110107421875), (433.216796875, 1140.047119140625), (474.0401306152344, 1143.28564453125), (501.7616882324219, 1148.7138671875), (547.2399291992188, 1154.597900390625), (569.5243530273438, 1154.098388671875), (607.7471313476562, 1149.053955078125), (633.3785400390625, 1141.205078125), (642.54248046875, 1136.43505859375), (657.3914794921875, 1130.681884765625), (663.9990234375, 1126.6591796875), (677.7175903320312, 1121.66015625), (690.0933837890625, 1117.7060546875), (693.81640625, 1116.932373046875), (697.6001586914062, 1114.344970703125), (698.030517578125, 1114.129638671875), (700.827880859375, 1112.7301025390625), (700.0277709960938, 1113.13037109375), (700.9362182617188, 1113.13037109375), (701.0263671875, 1112.131103515625), (703.0236206054688, 1112.131103515625)], 0.033000)
        post_action(0.398498)
        perform_click_event("Tap", 641.109558, 1254.020264, 0.087000, "Activity")
        post_action(0.883869)
        perform_click_event("Tap", 257.642181, 1113.130371, 0.069000, "Activity")
        post_action(1.379426)
        perform_click_event("Tap", 398.446625, 1109.133545, 0.082000, "Activity")
        post_action(1.269383)
        perform_click_event("Tap", 543.245483, 1107.135010, 0.068000, "Activity")
        post_action(0.801092)
        perform_swipe_event([(573.2039184570312, 1091.1475830078125), (537.256103515625, 1092.307861328125), (495.9746398925781, 1095.810791015625), (458.13739013671875, 1097.142822265625), (411.0277404785156, 1097.142822265625), (382.1761169433594, 1095.19873046875), (355.1480407714844, 1094.1451416015625), (343.65472412109375, 1094.1451416015625), (317.20025634765625, 1094.1451416015625), (294.34063720703125, 1095.1444091796875), (281.60888671875, 1096.643310546875), (260.08477783203125, 1099.868896484375), (241.2507781982422, 1102.138916015625), (230.67962646484375, 1103.13818359375), (225.12220764160156, 1104.137451171875), (222.36001586914062, 1105.467529296875), (222.6907196044922, 1105.1365966796875), (220.86265563964844, 1105.1365966796875), (220.19418334960938, 1105.1365966796875), (219.6948699951172, 1105.1365966796875), (218.69625854492188, 1105.1365966796875)], 0.033000)
        post_action(0.414106)
        perform_click_event("Tap", 481.331482, 1088.149902, 0.068000, "Activity")
        post_action(1.217213)
        perform_swipe_event([(521.2760009765625, 1088.14990234375), (500.2237243652344, 1084.81005859375), (450.8389587402344, 1084.1529541015625), (425.04840087890625, 1083.15380859375), (406.9619140625, 1082.154541015625), (385.9559020996094, 1081.1905517578125), (354.00836181640625, 1079.656494140625), (333.79241943359375, 1080.1561279296875), (314.02447509765625, 1079.1568603515625), (293.0133972167969, 1078.15771484375), (275.92010498046875, 1078.15771484375), (259.2428894042969, 1079.1568603515625), (249.45130920410156, 1080.5963134765625), (240.5001220703125, 1081.1553955078125), (236.3035888671875, 1081.1553955078125), (233.1761474609375, 1081.1553955078125), (231.67822265625, 1081.1553955078125)], 0.033000)
        post_action(0.437618)
        perform_click_event("Tap", 375.478516, 1085.152222, 0.055000, "Activity")
        post_action(0.685598)
        perform_click_event("Tap", 696.033325, 1091.147583, 0.099000, "Activity")
        post_action(1.046590)
        perform_click_event("Tap", 604.160889, 636.502747, 0.081000, "Dialog")
        post_action(1.409950)
        perform_swipe_event([(146.79612731933594, 1094.1451416015625), (207.87733459472656, 1090.3748779296875), (237.93734741210938, 1087.423583984375), (331.183837890625, 1079.7635498046875), (381.4942932128906, 1078.3326416015625), (463.3564453125, 1074.660400390625), (490.31903076171875, 1073.6611328125), (539.3018188476562, 1075.162841796875), (572.5660400390625, 1077.305908203125), (594.0370483398438, 1079.1396484375), (623.2735595703125, 1081.9163818359375), (637.0403442382812, 1082.154541015625), (656.1953735351562, 1083.15380859375), (672.53271484375, 1083.15380859375), (681.1090087890625, 1083.15380859375), (692.0006713867188, 1084.1529541015625), (696.5326538085938, 1085.65185546875), (696.0333251953125, 1085.1522216796875)], 0.033000)
        post_action(0.291955)
        perform_click_event("Tap", 473.342590, 1247.025757, 0.056000, "Activity")
        post_action(0.922161)
        perform_click_event("Tap", 46.934814, 1033.192871, 0.068000, "Activity")
        post_action(0.747676)
        perform_click_event("Tap", 88.876564, 1041.186523, 0.072000, "Activity")
        post_action(1.053332)
        perform_click_event("Tap", 61.914009, 120.905540, 0.056000, "Activity")
        post_action(0.696620)
        perform_click_event("Tap", 605.159485, 737.423889, 0.055000, "Dialog")
        post_action(1.116611)
        perform_click_event("Tap", 257.642181, 198.844650, 0.086000, "Activity")
        post_action(0.000000)

    except Exception as e:
        print(e)
        traceback_str = ''.join(traceback.format_tb(e.__traceback__))
        print(traceback_str)
    clean_up()
    