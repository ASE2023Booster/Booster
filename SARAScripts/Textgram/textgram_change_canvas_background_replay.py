# coding=utf8

import os
import sys
import time
import json
import frida
import argparse
import traceback
import uiautomator2 as u2
sys.path.append(os.path.abspath(os.getcwd()))
from script import util

frida_session = None
xml = None
view_hierarchy = None
save_path = None
action_count = 0
current_popup_window = None
curr_webview_address = None

d = u2.connect()
print(d.info)


def log(desc):
    global action_count
    print('[ReplayAction]-%d: ' % action_count, desc)


def error_handler(func):
    def wrapper(message, data):
        if message['type'] == 'error':
            print('[Func]: %s, [Error-msg]: %s' % (func.__name__, message))
            print('[Func]: %s, [Error-des]: %s' % (func.__name__, message['description']))
            print('[Func]: %s, [Error-sta]: %s' % (func.__name__, message['stack']))
            print('[Func]: %s, [Error-dat]: %s' % (func.__name__, data))
            return None
        else:
            return func(message, data)
    return wrapper


def preprocess_path():
    global save_path
    if save_path is None:
        return False
    if not os.path.exists(save_path):
        os.mkdir(save_path)
    else:
        for file in os.listdir(save_path):
            os.remove(os.path.join(save_path, file))
    return True


def post_action(custom_interval):
    global xml
    global d
    global action_count
    global save_path
    global view_hierarchy

    print('[ReplayTimeInterval]-%d: %s' % (action_count, json.dumps({'interval': custom_interval})))
    if action_count > 0:
        # time.sleep(1)
        if custom_interval > 0:
            time.sleep(custom_interval)
    xml = d.dump_hierarchy()
    xml = util.parse_xml(xml)
    screenshot_filename = os.path.join(save_path, '_'.join(['screenshot', str(action_count)]) + '.jpg')
    xml_filename = os.path.join(save_path, '_'.join(['ui', str(action_count)]) + '.xml')
    view_hierarchy_filename = os.path.join(save_path, '_'.join(['view_hierarchy', str(action_count)]) + '.xml')
    d.screenshot(screenshot_filename)
    util.save_xml(xml, xml_filename)
    view_hierarchy, lxml_view_hierarchy = util.dump_view_hierarchy(d, view_hierarchy_filename)
    action_count += 1


def set_text(rid, bounds, text):
    global xml
    view = util.find_view(rid, bounds, xml)
    if view is None:
        print('TextView ' + rid + ' does not exist')
    else:
        if len(rid) > 0:
            d(resourceId=rid, focused=True).set_text(text)
        else:
            d(focused=True).set_text(text)
        log('[set_text]-%s' % json.dumps({'rid': rid, 'text': text, 'bounds': bounds}))


def press_soft_keyboard(key_name):
    global xml
    index = util.find_soft_key(key_name, xml)
    if index is None:
        raise Exception('Key ' + key_name + ' does not exist')
    key_x, key_y = index[0], index[1]
    d.click(key_x, key_y)
    log('[press_key]-%s' % json.dumps({'key_name': key_name}))


def hide_soft_keyboard():
    global xml
    if util.check_soft_keyboard(xml):
        print('Hide soft keyboard')
        d.press('back')
        log('[hide_keyboard]')


def record_popup_window():
    global current_popup_window
    current_popup_window = util.get_current_window(d)
    log('[record_popup_window]-%s' % json.dumps({'window': current_popup_window}))


def close_popup_window():
    global current_popup_window
    if current_popup_window is not None:
        window = util.get_current_window(d)
        if window == current_popup_window:
            d.press('back')
            log('[hide_popup_window]-%s' % json.dumps({'window': current_popup_window}))
            current_popup_window = None


def clean_up():
    global frida_session
    print('Clean Up....')
    frida_session.detach()


def detect_webview():
    # Get WebView handle
    global frida_session
    instrument_script = frida_session.create_script(util.instrument_WebView())
    instrument_script.on('message', get_instrument_WebView_message)
    instrument_script.load()


@error_handler
def get_instrument_WebView_message(message, data):
    global curr_webview_address
    print('[WebView]: ', message)
    curr_webview_address = util.get_view_address(message['payload']['webview'])


def perform_click_event(tap_type, x, y, duration, view_type):
    global action_count
    global view_hierarchy
    global frida_session

    if view_type == 'Activity':
        candidates = util.find_component_candidates(view_hierarchy, x, y)
        # Instrument
        instrument_script = None
        code = util.instrument_view([candidate['classname'] for candidate in candidates], [candidate['address'] for candidate in candidates], action_count)
        instrument_script = frida_session.create_script(code)
        instrument_script.on('message', get_instrument_view_message)
        instrument_script.load()
        if tap_type == 'LongTap':
            d.long_click(x, y, duration)
        elif tap_type == 'Tap':
            d.long_click(x, y, duration)
        elif tap_type == 'DoubleTap':
            d.double_click(x, y, 0.1)

        # time.sleep(1)
        instrument_script.unload()
        log('[click]-%s' % json.dumps({'tap_type': tap_type, 'x': x, 'y': y, 'duration': duration, 'candidate': candidates, 'view_type': view_type}))

    else:
        # Dialog & PopupWindow
        # command `adb shell dumpsys activity top` fails to extract view hierarchy of Dialog & PopupWindow
        if tap_type == 'LongTap':
            d.long_click(x, y, duration)
        elif tap_type == 'Tap':
            d.long_click(x, y, duration)
        elif tap_type == 'DoubleTap':
            d.double_click(x, y, 0.1)
        log('[click]-%s' % json.dumps({'tap_type': tap_type, 'x': x, 'y': y, 'duration': duration, 'view_type': view_type}))


@error_handler
def get_instrument_view_message(message, data):
    print('[ReplayViewInstrumentation]: %s' % json.dumps(message))


def perform_swipe_event(pointers, duration=0.01):
    d.swipe_points(pointers, duration)
    log('[swipe]-%s' % json.dumps({'pointers': pointers, 'duration': duration}))


def perform_key_event(key_code):
    d.press(key_code)
    log('[press]-%s' % json.dumps({'key_code': key_code}))


def webview_set_text(input_selector, text, webview_classname, package_name):
    # Set Text
    global curr_webview_address
    code = util.webview_set_text(input_selector, text, webview_classname, curr_webview_address, package_name)
    instrument_script = frida_session.create_script(code)
    instrument_script.on('message', get_webview_set_text_message)
    instrument_script.load()


def webview_set_text_with_u2(text):
    d(focused=True).set_text(text)
    log('[webview_set_text]-%s' % json.dumps({'text': text}))


@error_handler
def get_webview_set_text_message(message, data):
    print('[WebViewSetText]: ', message)


def instrument_chrome_client():
    code = util.instrument_chrome_client()
    script = frida_session.create_script(code)
    script.on('message', get_instrument_chrome_client_message)
    script.load()


@error_handler
def get_instrument_chrome_client_message(message, data):
    print('[Console]: ', message)


if __name__ == '__main__':
    parser = argparse.ArgumentParser(description='Argument Parser')
    parser.add_argument('--path', help='save path', required=True)
    parser.add_argument('--package', help='package name', required=True)
    parser.add_argument('--pid', help='pid name', required=True)
    args = parser.parse_args()
    
    save_path = args.path
    package_name = args.package
    pid = int(args.pid)

    if not preprocess_path():
        print('Save path not found')
        sys.exit()

    # Setup Dynamic instrument   
    all_devices = frida.enumerate_devices()
    device = frida.get_usb_device()

    # Attach
    frida_session = device.attach(pid)
    print(frida_session)

    try:
        detect_webview()
        # instrument_chrome_client()
        post_action(0)

        perform_click_event("Tap", 562.219177, 204.839966, 0.099000, "Activity")
        post_action(0.914014)
        perform_click_event("Tap", 353.509033, 607.525391, 0.095000, "Activity")
        post_action(1.729035)
        perform_click_event("Tap", 240.665741, 1240.031250, 0.111000, "Activity")
        post_action(1.876847)
        perform_click_event("Tap", 381.470184, 1104.137451, 0.068000, "Activity")
        post_action(2.556299)
        perform_click_event("Tap", 464.355072, 493.614349, 0.098000, "Dialog")
        post_action(1.921816)
        perform_swipe_event([(441.386962890625, 595.5347290039062), (424.03729248046875, 640.7048950195312), (410.8516540527344, 674.4877319335938), (404.45343017578125, 691.0206909179688), (395.9500732421875, 715.4410400390625), (390.39776611328125, 732.6077270507812), (389.2749938964844, 738.3450927734375), (388.4604797363281, 742.419921875), (387.46185302734375, 742.4199829101562)], 0.033000)
        post_action(0.445616)
        perform_click_event("Tap", 527.267700, 531.584717, 0.084000, "Dialog")
        post_action(0.770208)
        perform_click_event("Tap", 589.181702, 525.589355, 0.095000, "Dialog")
        post_action(0.585373)
        perform_click_event("Tap", 603.162292, 635.503540, 0.082000, "Dialog")
        post_action(0.463963)
        perform_click_event("Tap", 443.384186, 644.496460, 0.085000, "Dialog")
        post_action(2.121217)
        perform_click_event("Tap", 525.270447, 431.662750, 0.041000, "Dialog")
        post_action(0.967611)
        perform_click_event("Tap", 596.171997, 515.597168, 0.055000, "Dialog")
        post_action(1.740644)
        perform_click_event("Tap", 582.191406, 713.442627, 0.055000, "Dialog")
        post_action(0.654485)
        perform_click_event("Tap", 406.435516, 417.673706, 0.069000, "Dialog")
        post_action(1.000537)
        perform_click_event("Tap", 572.205261, 1025.199097, 0.100000, "Dialog")
        post_action(3.930760)
        perform_swipe_event([(521.2760009765625, 1073.16162109375), (483.7945251464844, 1082.6148681640625), (457.33935546875, 1090.38671875), (406.4804992675781, 1100.916015625), (373.9805908203125, 1105.13671875), (350.0596008300781, 1107.5438232421875), (317.1260986328125, 1111.4793701171875), (289.5978088378906, 1115.12890625), (263.04248046875, 1118.688232421875), (234.8001708984375, 1125.177490234375), (211.32408142089844, 1131.3114013671875), (182.52066040039062, 1135.1357421875), (167.87661743164062, 1137.111572265625), (158.77947998046875, 1138.11083984375), (155.78363037109375, 1139.110107421875)], 0.033000)
        post_action(0.408759)
        perform_click_event("Tap", 190.735092, 1093.145996, 0.085000, "Activity")
        post_action(1.151961)
        perform_click_event("Tap", 339.528442, 1085.152222, 0.082000, "Activity")
        post_action(1.110606)
        perform_click_event("Tap", 481.331482, 1103.138184, 0.080000, "Activity")
        post_action(0.582922)
        perform_swipe_event([(607.15673828125, 1074.1607666015625), (571.9412841796875, 1076.4854736328125), (538.7496948242188, 1081.239013671875), (509.7087707519531, 1086.2091064453125), (474.84051513671875, 1094.1451416015625), (453.810302734375, 1100.377685546875), (415.75567626953125, 1107.7567138671875), (379.95098876953125, 1114.4444580078125), (360.7907409667969, 1117.697021484375), (319.92694091796875, 1122.4151611328125), (297.3384704589844, 1125.091552734375), (267.0823059082031, 1130.4317626953125), (249.941162109375, 1132.09326171875), (223.2517547607422, 1136.3519287109375), (208.7967529296875, 1139.00341796875), (184.81019592285156, 1142.828369140625), (174.2746124267578, 1144.976318359375), (152.328125, 1148.4871826171875), (146.68939208984375, 1150.1014404296875), (135.03948974609375, 1151.1007080078125), (121.44593048095703, 1152.0999755859375), (116.83772277832031, 1153.5986328125), (112.39070892333984, 1153.09912109375), (110.80000305175781, 1154.1444091796875), (109.34812927246094, 1154.098388671875), (109.8474349975586, 1154.098388671875)], 0.033000)
        post_action(0.431454)
        perform_click_event("Tap", 431.400848, 1092.146729, 0.068000, "Activity")
        post_action(0.788043)
        perform_click_event("Tap", 305.575592, 1088.149902, 0.055000, "Activity")
        post_action(1.153884)
        perform_swipe_event([(543.2454833984375, 1073.16162109375), (521.2686767578125, 1074.535888671875), (501.510986328125, 1077.1396484375), (468.81903076171875, 1080.7596435546875), (428.4049987792969, 1085.6517333984375), (378.1554870605469, 1094.608642578125), (341.99432373046875, 1103.0208740234375), (321.12799072265625, 1106.33935546875), (288.8581848144531, 1111.6473388671875), (272.4676513671875, 1115.3948974609375), (240.16644287109375, 1125.1209716796875), (224.2945556640625, 1129.466064453125), (184.51849365234375, 1138.4168701171875), (170.88125610351562, 1141.2972412109375), (141.5286865234375, 1145.732421875), (124.6173324584961, 1147.990234375), (116.57984924316406, 1149.3118896484375), (109.96888732910156, 1150.1014404296875), (107.47057342529297, 1151.1007080078125), (106.85160064697266, 1151.1007080078125), (107.52682495117188, 1151.7763671875), (107.85021209716797, 1152.0999755859375)], 0.033000)
        post_action(0.568325)
        perform_swipe_event([(575.2011108398438, 1075.1600341796875), (555.321044921875, 1074.518310546875), (529.02197265625, 1075.33251953125), (496.8206787109375, 1079.5714111328125), (471.27978515625, 1082.1090087890625), (424.8638610839844, 1089.084228515625), (398.0030212402344, 1094.0340576171875), (356.3765563964844, 1103.72900390625), (336.6695251464844, 1107.50732421875), (309.67926025390625, 1113.3529052734375), (283.6745300292969, 1118.7122802734375), (274.0412902832031, 1121.8392333984375), (250.5691375732422, 1127.6929931640625), (239.89785766601562, 1131.0394287109375), (223.79554748535156, 1133.385009765625), (215.49075317382812, 1136.1822509765625), (200.24508666992188, 1140.6737060546875), (193.1920928955078, 1142.2154541015625), (182.6820068359375, 1145.3179931640625), (176.1614990234375, 1147.1038818359375), (174.09844970703125, 1147.9329833984375), (171.3582763671875, 1148.10302734375), (170.26351928710938, 1148.10302734375), (170.76283264160156, 1148.987548828125), (170.76283264160156, 1149.102294921875)], 0.029500)
        post_action(0.446087)
        perform_swipe_event([(594.1747436523438, 1065.1678466796875), (559.5003051757812, 1070.889892578125), (533.4838256835938, 1074.623046875), (503.29083251953125, 1078.0340576171875), (451.37310791015625, 1085.6517333984375), (398.2725830078125, 1094.0076904296875), (343.6347961425781, 1102.7216796875), (325.30584716796875, 1105.648193359375), (281.6009826660156, 1108.6348876953125), (267.39239501953125, 1110.7071533203125), (233.9979248046875, 1114.8486328125), (222.45272827148438, 1117.0797119140625), (206.59320068359375, 1120.9775390625), (198.52395629882812, 1122.15185546875), (192.5784149169922, 1123.148193359375), (172.76007080078125, 1128.11865234375), (165.30474853515625, 1130.392822265625), (152.1622772216797, 1133.271240234375), (146.33920288085938, 1135.6956787109375), (137.19485473632812, 1138.7640380859375), (134.96408081054688, 1139.110107421875), (130.56936645507812, 1140.1092529296875), (129.36114501953125, 1141.5673828125), (127.82247161865234, 1142.107666015625)], 0.033000)
        post_action(0.562585)
        perform_click_event("Tap", 703.023621, 1082.154541, 0.112000, "Activity")
        post_action(2.716316)
        perform_swipe_event([(544.244140625, 901.2958374023438), (547.6898803710938, 854.34716796875), (556.8387451171875, 818.718017578125), (563.9910888671875, 782.9248657226562), (572.5586547851562, 743.00390625), (579.4451904296875, 709.1961669921875), (581.88671875, 679.4360961914062), (584.4428100585938, 649.6929931640625), (585.5204467773438, 631.1714477539062), (586.1858520507812, 609.02294921875), (587.1845092773438, 590.3192138671875), (588.18310546875, 574.051513671875), (589.1817016601562, 556.126708984375), (589.1817016601562, 541.2523803710938), (590.958740234375, 523.9138793945312), (592.1775512695312, 513.2938842773438), (594.674072265625, 502.6073303222656), (595.1734008789062, 498.8224792480469), (596.1719970703125, 491.3213195800781), (597.1705932617188, 489.3920593261719), (597.1705932617188, 485.9656982421875), (597.1705932617188, 485.62060546875), (598.42041015625, 484.3700866699219), (598.1692504882812, 484.62139892578125), (599.1678466796875, 484.62139892578125)], 0.033000)
        post_action(0.431422)
        perform_swipe_event([(485.3259582519531, 878.3138427734375), (483.1001892089844, 840.5473022460938), (490.3258361816406, 797.5944213867188), (495.42840576171875, 779.148681640625), (513.5040893554688, 706.3563232421875), (527.7951049804688, 638.9482421875), (536.1670532226562, 575.69775390625), (541.07861328125, 518.464111328125), (546.4680786132812, 479.3387756347656), (552.5004272460938, 444.0463562011719), (557.0322875976562, 421.4469909667969), (560.9343872070312, 410.77655029296875), (562.9349365234375, 403.1763000488281), (566.9519653320312, 389.7380065917969), (569.0772705078125, 384.9639587402344), (572.6895751953125, 376.97796630859375), (572.7113037109375, 373.6946105957031), (573.2039184570312, 370.95361328125), (574.2944946289062, 369.61907958984375), (574.2025146484375, 368.21234130859375), (574.2025146484375, 367.7127380371094), (575.2011108398438, 367.7127380371094), (576.19970703125, 367.7127380371094)], 0.033000)
        post_action(0.331155)
        perform_swipe_event([(430.4022216796875, 904.2935180664062), (429.5538330078125, 885.6173706054688), (433.88604736328125, 846.2440185546875), (439.3897399902344, 814.8634033203125), (453.0367431640625, 749.084716796875), (462.3138427734375, 705.656494140625), (478.2830810546875, 640.57470703125), (494.548828125, 576.31298828125), (508.67535400390625, 518.7256469726562), (523.7135620117188, 475.49212646484375), (530.2653198242188, 456.6390686035156), (533.8797607421875, 450.4056701660156), (536.7545166015625, 441.6549377441406), (540.3843994140625, 435.39013671875), (541.452880859375, 435.6596374511719), (541.248291015625, 434.6604309082031), (541.248291015625, 433.79254150390625), (542.6950073242188, 433.66119384765625), (542.2468872070312, 433.66119384765625), (542.2468872070312, 434.6604309082031)], 0.033000)
        post_action(0.514456)
        perform_swipe_event([(369.4868469238281, 897.2990112304688), (372.6678466796875, 874.7966918945312), (378.0085754394531, 846.6705932617188), (387.6886291503906, 802.54443359375), (404.8951110839844, 727.7100219726562), (420.6886901855469, 678.2874145507812), (440.8876953125, 621.514404296875), (448.90081787109375, 594.3438720703125), (466.5683898925781, 541.9275512695312), (473.428466796875, 525.95166015625), (493.1789855957031, 482.89483642578125), (505.2869873046875, 452.6800537109375), (512.122802734375, 440.3545837402344), (517.4624633789062, 424.9119873046875), (520.9983520507812, 420.0888366699219), (522.310791015625, 415.6029052734375), (522.274658203125, 414.676025390625), (523.2732543945312, 413.67681884765625), (524.2718505859375, 413.67681884765625), (525.11083984375, 412.6775817871094), (526.1444702148438, 413.5521240234375), (526.2691040039062, 413.67681884765625)], 0.033000)
        post_action(0.453175)
        perform_swipe_event([(411.4285888671875, 873.3177490234375), (421.6408996582031, 830.5357666015625), (429.8200988769531, 806.1189575195312), (438.8263244628906, 774.6149291992188), (460.6171875, 711.8667602539062), (469.750244140625, 686.7230834960938), (496.9672546386719, 617.0858764648438), (506.4324951171875, 589.0513305664062), (525.780517578125, 535.1312255859375), (535.6122436523438, 510.79962158203125), (540.7866821289062, 501.916748046875), (551.0479125976562, 482.4032897949219), (555.8681030273438, 474.2592468261719), (560.0346069335938, 466.0111389160156), (564.8606567382812, 457.35235595703125), (567.9585571289062, 453.1511535644531), (571.1775512695312, 447.7085876464844), (571.2066650390625, 446.38848876953125), (572.2052612304688, 445.6518249511719)], 0.029000)
        post_action(0.362348)
        perform_click_event("Tap", 441.386963, 922.279480, 0.098000, "Dialog")
        post_action(2.152974)
        perform_swipe_event([(191.73370361328125, 1090.1483154296875), (230.3750457763672, 1092.146728515625), (287.3619689941406, 1091.477294921875), (345.7614440917969, 1089.25927734375), (401.9012451171875, 1087.6522216796875), (446.4046936035156, 1087.150634765625), (491.27764892578125, 1088.26513671875), (530.6884155273438, 1086.714111328125), (565.7305297851562, 1085.4200439453125), (596.1572265625, 1085.1522216796875), (607.0551147460938, 1085.1522216796875), (626.4085083007812, 1085.1522216796875), (639.8685913085938, 1085.1522216796875), (646.1026611328125, 1085.1522216796875), (648.5911865234375, 1084.1529541015625), (651.315673828125, 1082.9337158203125)], 0.033000)
        post_action(0.415515)
        perform_swipe_event([(145.79750061035156, 1094.1451416015625), (165.06520080566406, 1095.7518310546875), (204.45079040527344, 1096.052490234375), (261.3057556152344, 1094.6959228515625), (332.5367431640625, 1093.23974609375), (398.9998779296875, 1091.0625), (435.2237243652344, 1091.1475830078125), (485.82525634765625, 1091.1475830078125), (511.2792663574219, 1092.9227294921875), (550.7839965820312, 1096.8367919921875), (562.2675170898438, 1096.1436767578125), (576.408447265625, 1097.142822265625), (602.2908325195312, 1096.1436767578125), (615.1251220703125, 1094.9466552734375), (638.11376953125, 1093.6455078125), (645.6915893554688, 1092.4288330078125), (658.0606689453125, 1091.1475830078125), (660.7749633789062, 1090.1483154296875), (666.6021118164062, 1090.1483154296875), (668.6778564453125, 1090.1483154296875), (670.0693359375, 1090.1483154296875)], 0.031000)
        post_action(0.417031)
        perform_swipe_event([(198.7239990234375, 1085.1522216796875), (239.775390625, 1091.27783203125), (292.6981201171875, 1094.9033203125), (335.4779968261719, 1095.068359375), (384.8015441894531, 1093.2816162109375), (420.8570556640625, 1091.9453125), (473.5669860839844, 1088.8602294921875), (502.7752990722656, 1088.14990234375), (539.7120361328125, 1087.253173828125), (557.5143432617188, 1087.150634765625), (574.5736694335938, 1088.6396484375), (595.5107421875, 1089.8157958984375), (603.0921630859375, 1090.1483154296875), (607.7160034179688, 1091.2874755859375), (618.389892578125, 1091.1475830078125), (623.8815307617188, 1092.146728515625), (633.973388671875, 1093.1094970703125), (640.5646362304688, 1091.8560791015625), (645.8280029296875, 1092.146728515625), (650.4725341796875, 1092.146728515625), (655.0701904296875, 1092.146728515625), (657.08740234375, 1091.1475830078125)], 0.025000)
        post_action(0.436769)
        perform_swipe_event([(207.71151733398438, 1078.15771484375), (244.89080810546875, 1083.2889404296875), (279.62744140625, 1087.415283203125), (308.50054931640625, 1090.4564208984375), (341.69610595703125, 1095.3995361328125), (367.2803955078125, 1098.0673828125), (411.9817199707031, 1095.8782958984375), (443.1482849121094, 1093.2489013671875), (490.4626770019531, 1087.9459228515625), (512.5992431640625, 1085.2919921875), (538.06591796875, 1085.1522216796875), (544.8668823242188, 1085.1522216796875), (554.8697509765625, 1085.1522216796875), (557.2922973632812, 1085.1522216796875), (564.1575927734375, 1085.1522216796875), (566.1654052734375, 1085.1522216796875), (572.2052612304688, 1085.1522216796875), (574.3820190429688, 1085.1522216796875), (579.3771362304688, 1085.1522216796875), (581.6710815429688, 1085.1522216796875), (585.3392333984375, 1085.1522216796875), (588.8358154296875, 1085.1522216796875), (591.5794067382812, 1085.1522216796875), (593.6193237304688, 1085.1522216796875), (594.1747436523438, 1085.1522216796875), (595.232177734375, 1085.1522216796875)], 0.033000)
        post_action(0.584333)
        perform_click_event("Tap", 510.291260, 1089.149048, 0.067000, "Activity")
        post_action(1.237396)
        perform_swipe_event([(230.6796112060547, 1100.1405029296875), (255.6449432373047, 1101.1397705078125), (306.4564208984375, 1101.8697509765625), (365.458251953125, 1106.6927490234375), (418.11328125, 1107.580322265625), (473.2280578613281, 1107.135009765625), (528.7770385742188, 1107.5997314453125), (557.3338012695312, 1109.891845703125), (572.1224975585938, 1110.1326904296875), (595.34716796875, 1112.32861328125), (620.1228637695312, 1113.90576171875), (637.5471801757812, 1114.129638671875), (645.5016479492188, 1112.73095703125), (650.8828735351562, 1113.13037109375), (655.6905517578125, 1113.13037109375), (661.297119140625, 1114.201416015625), (663.8715209960938, 1114.129638671875), (669.7699584960938, 1114.129638671875), (673.7225952148438, 1114.129638671875), (676.5592651367188, 1114.129638671875), (681.7130126953125, 1114.129638671875), (682.052734375, 1114.129638671875), (684.0499267578125, 1114.129638671875), (685.0791625976562, 1114.129638671875), (686.0471801757812, 1114.129638671875)], 0.033000)
        post_action(0.493863)
        perform_click_event("Tap", 92.871017, 1085.152222, 0.099000, "Activity")
        post_action(4.802063)
        perform_swipe_event([(272.6213684082031, 1231.0382080078125), (302.49755859375, 1228.0406494140625), (336.8692321777344, 1226.237548828125), (390.9495849609375, 1220.1390380859375), (446.08697509765625, 1215.4110107421875), (494.5107727050781, 1212.9302978515625), (506.749755859375, 1211.94140625), (526.6806640625, 1211.0538330078125), (534.0928955078125, 1211.970458984375), (535.5570068359375, 1212.0531005859375), (536.2551879882812, 1211.0538330078125), (538.0170288085938, 1211.0538330078125), (542.2062377929688, 1210.0750732421875), (542.2468872070312, 1210.0546875)], 0.033000)
        post_action(1.219257)
        perform_click_event("Tap", 37.947296, 121.904762, 0.111000, "Activity")
        post_action(0.917241)
        perform_click_event("Tap", 594.174744, 730.429321, 0.082000, "Dialog")
        post_action(2.662577)
        perform_click_event("Tap", 239.667130, 195.847000, 0.097000, "Activity")
        post_action(0.000000)

    except Exception as e:
        print(e)
        traceback_str = ''.join(traceback.format_tb(e.__traceback__))
        print(traceback_str)
    clean_up()
    