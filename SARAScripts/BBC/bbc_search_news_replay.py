# coding=utf8

import os
import sys
import time
import json
import frida
import argparse
import traceback
import uiautomator2 as u2
sys.path.append(os.path.abspath(os.getcwd()))
sys.path.append(os.path.abspath(os.getcwd()))
from script import util

frida_session = None
xml = None
view_hierarchy = None
save_path = None
action_count = 0
current_popup_window = None
curr_webview_address = None

d = u2.connect()
print(d.info)


def log(desc):
    global action_count
    print('[ReplayAction]-%d: ' % action_count, desc)


def error_handler(func):
    def wrapper(message, data):
        if message['type'] == 'error':
            print('[Func]: %s, [Error-msg]: %s' % (func.__name__, message))
            print('[Func]: %s, [Error-des]: %s' % (func.__name__, message['description']))
            print('[Func]: %s, [Error-sta]: %s' % (func.__name__, message['stack']))
            print('[Func]: %s, [Error-dat]: %s' % (func.__name__, data))
            return None
        else:
            return func(message, data)
    return wrapper


def preprocess_path():
    global save_path
    if save_path is None:
        return False
    if not os.path.exists(save_path):
        os.mkdir(save_path)
    else:
        for file in os.listdir(save_path):
            os.remove(os.path.join(save_path, file))
    return True


def post_action(custom_interval):
    global xml
    global d
    global action_count
    global save_path
    global view_hierarchy

    print('[ReplayTimeInterval]-%d: %s' % (action_count, json.dumps({'interval': custom_interval})))
    if action_count > 0:
        # time.sleep(1)
        if custom_interval > 0:
            time.sleep(custom_interval)
    xml = d.dump_hierarchy()
    xml = util.parse_xml(xml)
    screenshot_filename = os.path.join(save_path, '_'.join(['screenshot', str(action_count)]) + '.jpg')
    xml_filename = os.path.join(save_path, '_'.join(['ui', str(action_count)]) + '.xml')
    view_hierarchy_filename = os.path.join(save_path, '_'.join(['view_hierarchy', str(action_count)]) + '.xml')
    d.screenshot(screenshot_filename)
    util.save_xml(xml, xml_filename)
    view_hierarchy, lxml_view_hierarchy = util.dump_view_hierarchy(d, view_hierarchy_filename)
    action_count += 1


def set_text(rid, bounds, text):
    global xml
    view = util.find_view(rid, bounds, xml)
    if view is None:
        print('TextView ' + rid + ' does not exist')
    else:
        if len(rid) > 0:
            d(resourceId=rid, focused=True).set_text(text)
        else:
            d(focused=True).set_text(text)
        log('[set_text]-%s' % json.dumps({'rid': rid, 'text': text, 'bounds': bounds}))


def press_soft_keyboard(key_name):
    global xml
    index = util.find_soft_key(key_name, xml)
    if index is None:
        raise Exception('Key ' + key_name + ' does not exist')
    key_x, key_y = index[0], index[1]
    d.click(key_x, key_y)
    log('[press_key]-%s' % json.dumps({'key_name': key_name}))


def hide_soft_keyboard():
    global xml
    if util.check_soft_keyboard(xml):
        print('Hide soft keyboard')
        d.press('back')
        log('[hide_keyboard]')


def record_popup_window():
    global current_popup_window
    current_popup_window = util.get_current_window(d)
    log('[record_popup_window]-%s' % json.dumps({'window': current_popup_window}))


def close_popup_window():
    global current_popup_window
    if current_popup_window is not None:
        window = util.get_current_window(d)
        if window == current_popup_window:
            d.press('back')
            log('[hide_popup_window]-%s' % json.dumps({'window': current_popup_window}))
            current_popup_window = None


def clean_up():
    global frida_session
    print('Clean Up....')
    frida_session.detach()


def detect_webview():
    # Get WebView handle
    global frida_session
    instrument_script = frida_session.create_script(util.instrument_WebView())
    instrument_script.on('message', get_instrument_WebView_message)
    instrument_script.load()


@error_handler
def get_instrument_WebView_message(message, data):
    global curr_webview_address
    print('[WebView]: ', message)
    curr_webview_address = util.get_view_address(message['payload']['webview'])


def perform_click_event(tap_type, x, y, duration, view_type):
    global action_count
    global view_hierarchy
    global frida_session

    if view_type == 'Activity':
        candidates = util.find_component_candidates(view_hierarchy, x, y)
        # Instrument
        instrument_script = None
        code = util.instrument_view([candidate['classname'] for candidate in candidates], [candidate['address'] for candidate in candidates], action_count)
        instrument_script = frida_session.create_script(code)
        instrument_script.on('message', get_instrument_view_message)
        instrument_script.load()
        if tap_type == 'LongTap':
            d.long_click(x, y, duration)
        elif tap_type == 'Tap':
            d.long_click(x, y, duration)
        elif tap_type == 'DoubleTap':
            d.double_click(x, y, 0.1)

        # time.sleep(1)
        instrument_script.unload()
        log('[click]-%s' % json.dumps({'tap_type': tap_type, 'x': x, 'y': y, 'duration': duration, 'candidate': candidates, 'view_type': view_type}))

    else:
        # Dialog & PopupWindow
        # command `adb shell dumpsys activity top` fails to extract view hierarchy of Dialog & PopupWindow
        if tap_type == 'LongTap':
            d.long_click(x, y, duration)
        elif tap_type == 'Tap':
            d.long_click(x, y, duration)
        elif tap_type == 'DoubleTap':
            d.double_click(x, y, 0.1)
        log('[click]-%s' % json.dumps({'tap_type': tap_type, 'x': x, 'y': y, 'duration': duration, 'view_type': view_type}))


@error_handler
def get_instrument_view_message(message, data):
    print('[ReplayViewInstrumentation]: %s' % json.dumps(message))


def perform_swipe_event(pointers, duration=0.01):
    d.swipe_points(pointers, duration)
    log('[swipe]-%s' % json.dumps({'pointers': pointers, 'duration': duration}))


def perform_key_event(key_code):
    d.press(key_code)
    log('[press]-%s' % json.dumps({'key_code': key_code}))


def webview_set_text(input_selector, text, webview_classname, package_name):
    # Set Text
    global curr_webview_address
    code = util.webview_set_text(input_selector, text, webview_classname, curr_webview_address, package_name)
    instrument_script = frida_session.create_script(code)
    instrument_script.on('message', get_webview_set_text_message)
    instrument_script.load()


def webview_set_text_with_u2(text):
    d(focused=True).set_text(text)
    log('[webview_set_text]-%s' % json.dumps({'text': text}))


@error_handler
def get_webview_set_text_message(message, data):
    print('[WebViewSetText]: ', message)


def instrument_chrome_client():
    code = util.instrument_chrome_client()
    script = frida_session.create_script(code)
    script.on('message', get_instrument_chrome_client_message)
    script.load()


@error_handler
def get_instrument_chrome_client_message(message, data):
    print('[Console]: ', message)


if __name__ == '__main__':
    parser = argparse.ArgumentParser(description='Argument Parser')
    parser.add_argument('--path', help='save path', required=True)
    parser.add_argument('--package', help='package name', required=True)
    parser.add_argument('--pid', help='pid name', required=True)
    args = parser.parse_args()
    
    save_path = args.path
    package_name = args.package
    pid = int(args.pid)

    if not preprocess_path():
        print('Save path not found')
        sys.exit()

    # Setup Dynamic instrument   
    all_devices = frida.enumerate_devices()
    device = frida.get_usb_device()

    # Attach
    frida_session = device.attach(pid)
    print(frida_session)

    try:
        detect_webview()
        # instrument_chrome_client()
        post_action(0)

        perform_click_event("Tap", 563.217773, 105.917252, 0.055000, "Activity")
        post_action(2.753827)
        set_text("bbc.mobile.news.ww:id/search", "[144,79][704,128]", "nba")
        post_action(0.821975)
        press_soft_keyboard("search")
        post_action(4.081837)
        perform_click_event("Tap", 552.233032, 496.612030, 0.125000, "Activity")
        post_action(6.020403)
        perform_swipe_event([(527.2677001953125, 966.2451171875), (530.66650390625, 924.2432250976562), (532.9589233398438, 899.6071166992188), (536.4742431640625, 878.7777099609375), (539.0072021484375, 870.6744995117188), (541.9896240234375, 857.6181030273438), (544.1911010742188, 844.6586303710938), (546.7012329101562, 836.9645385742188), (549.2371826171875, 832.3497314453125), (553.7083740234375, 818.6668701171875), (559.6138305664062, 805.3931274414062), (562.8173217773438, 797.9789428710938), (570.5618896484375, 779.1131591796875), (573.6517333984375, 771.6841430664062), (577.3744506835938, 762.992431640625), (583.1253051757812, 751.0751342773438), (585.0930786132812, 746.15283203125), (589.2446899414062, 738.2339477539062), (590.207763671875, 737.3964233398438), (590.1802978515625, 735.4254760742188), (590.1802978515625, 734.4262084960938), (591.178955078125, 733.427001953125), (591.178955078125, 732.1209106445312), (592.1775512695312, 731.4285888671875)], 0.028500)
        post_action(3.538105)
        perform_swipe_event([(386.4632568359375, 1081.1553955078125), (399.3227233886719, 1050.669921875), (403.1849060058594, 1040.82470703125), (413.4258117675781, 1012.7088623046875), (419.6507568359375, 1000.1346435546875), (426.2388610839844, 979.0194702148438), (437.70233154296875, 951.9736938476562), (442.7828063964844, 938.9225463867188), (453.0212707519531, 916.8201293945312), (458.3611755371094, 904.7981567382812), (465.03106689453125, 889.9508666992188), (471.2596130371094, 879.4503173828125), (482.3746032714844, 859.9354248046875), (496.9022216796875, 837.597900390625), (508.25531005859375, 819.4141235351562), (518.0343627929688, 803.7413330078125), (523.9439086914062, 793.0371704101562), (528.3081665039062, 787.3428955078125), (529.264892578125, 784.8868408203125), (530.2635498046875, 784.5215454101562), (530.2635498046875, 784.38720703125)], 0.033000)
        post_action(1.900795)
        perform_swipe_event([(459.36199951171875, 1070.1639404296875), (461.5760803222656, 1051.7021484375), (464.2685241699219, 1035.624267578125), (468.1048583984375, 1019.6801147460938), (475.8531188964844, 986.497314453125), (480.995849609375, 967.9202270507812), (488.3033142089844, 937.5869750976562), (517.237548828125, 852.9329223632812), (529.5571899414062, 824.7702026367188), (539.6621704101562, 805.5825805664062), (550.2207641601562, 785.1629638671875), (559.203125, 772.0903930664062), (561.60107421875, 765.2588500976562), (562.2191772460938, 761.42919921875), (563.2097778320312, 761.4051513671875), (563.2177734375, 761.4051513671875)], 0.033000)
        post_action(1.882656)
        perform_swipe_event([(502.3023681640625, 1052.177978515625), (507.798583984375, 1001.9422607421875), (511.3967590332031, 986.0634765625), (515.5284423828125, 956.031005859375), (516.5424194335938, 943.405029296875), (518.89111328125, 923.3841552734375), (520.9284057617188, 914.5038452148438), (522.3765258789062, 903.8857421875), (523.7224731445312, 899.9473266601562), (525.2704467773438, 891.4634399414062), (526.202392578125, 887.5069580078125), (527.2677001953125, 883.1259155273438), (528.6873779296875, 880.46875), (529.264892578125, 877.5979614257812), (529.264892578125, 876.8292236328125), (529.264892578125, 876.3153686523438)], 0.030500)
        post_action(2.231944)
        perform_swipe_event([(340.52703857421875, 1103.13818359375), (365.03076171875, 1067.0814208984375), (362.32891845703125, 1064.6368408203125), (372.7396240234375, 1040.4794921875), (378.4743347167969, 1026.1982421875), (387.3099060058594, 1002.6224975585938), (394.7547302246094, 984.4229125976562), (397.259765625, 976.8023071289062), (401.87664794921875, 965.6586303710938), (408.0047912597656, 954.1117553710938), (410.2435607910156, 949.6314697265625), (414.97369384765625, 942.7134399414062), (418.3507385253906, 938.3351440429688), (419.6992492675781, 935.7046508789062), (420.4161071777344, 933.7704467773438), (421.19915771484375, 933.486572265625), (422.67169189453125, 931.013916015625), (423.63092041015625, 931.2724609375)], 0.033000)
        post_action(4.507952)
        perform_swipe_event([(521.2760009765625, 760.4059448242188), (509.80291748046875, 791.01953125), (507.6138000488281, 795.74072265625), (494.4566345214844, 830.74951171875), (487.4951477050781, 848.8201904296875), (482.6737365722656, 863.2932739257812), (476.6749572753906, 886.296630859375), (471.35205078125, 906.76806640625), (467.6920471191406, 916.5758666992188), (466.3705749511719, 923.187255859375), (464.2279052734375, 932.9078369140625), (462.6520690917969, 938.6773681640625), (462.35784912109375, 941.5104370117188), (461.0574645996094, 948.165771484375), (461.3592224121094, 950.9806518554688), (461.3592224121094, 953.2306518554688), (461.3592224121094, 955.5230712890625), (459.861328125, 956.7525634765625), (460.3606262207031, 957.2521362304688)], 0.033000)
        post_action(0.531647)
        perform_swipe_event([(479.3342590332031, 1068.16552734375), (481.3094787597656, 1047.4130859375), (481.33148193359375, 1030.115234375), (483.03515625, 1005.1544799804688), (484.07989501953125, 994.7006225585938), (486.61944580078125, 969.2897338867188), (490.0487365722656, 948.6122436523438), (496.26611328125, 920.5264282226562), (501.8643798828125, 898.7713623046875), (507.0906677246094, 881.7212524414062), (511.4570007324219, 864.73876953125), (514.5073852539062, 853.001708984375), (519.908447265625, 839.2679443359375), (521.109375, 835.0149536132812), (525.1519165039062, 824.59326171875), (526.7396850585938, 818.946533203125), (529.3602905273438, 813.1736450195312), (530.2635498046875, 810.9541015625), (531.2621459960938, 811.3660888671875)], 0.033000)
        post_action(1.979159)
        perform_swipe_event([(447.378662109375, 1052.177978515625), (454.5240478515625, 1023.5789184570312), (456.9891357421875, 1009.9037475585938), (460.6448669433594, 987.6668090820312), (466.117919921875, 963.4208374023438), (473.34259033203125, 930.7728881835938), (480.4030456542969, 912.0765991210938), (484.3678283691406, 901.187744140625), (491.955810546875, 884.1908569335938), (521.2760009765625, 820.3590698242188)], 0.034000)
        post_action(1.152473)
        perform_swipe_event([(377.4757385253906, 1030.1951904296875), (383.62835693359375, 1006.5957641601562), (394.3603210449219, 980.2667236328125), (412.1049499511719, 941.9095458984375), (430.9820556640625, 901.3389282226562), (456.88421630859375, 853.0897216796875), (470.5073547363281, 830.4700927734375), (481.32342529296875, 813.3806762695312), (487.9974060058594, 804.750244140625), (503.2335205078125, 783.9029541015625), (513.3217163085938, 770.3519287109375), (527.795654296875, 749.5162963867188), (545.769287109375, 725.1426391601562), (557.6930541992188, 713.974609375), (561.6907958984375, 710.7974243164062), (564.3244018554688, 705.2326049804688), (565.7142333984375, 705.4488525390625), (564.2163696289062, 705.4488525390625), (557.5676879882812, 713.032470703125), (533.0758666992188, 756.3963012695312), (502.9564514160156, 828.6290283203125), (481.6092529296875, 895.292236328125), (465.61077880859375, 981.8499755859375), (463.3564453125, 1021.267822265625), (462.1545715332031, 1037.410888671875), (460.3606262207031, 1047.3165283203125), (460.3606262207031, 1051.2353515625), (460.3606262207031, 1051.1787109375), (460.3606262207031, 1052.177978515625)], 0.033000)
        post_action(0.647597)
        perform_key_event(4)
        post_action(1.047510)
        perform_swipe_event([(440.38836669921875, 1116.1280517578125), (446.38006591796875, 1072.162353515625), (449.79345703125, 1045.674072265625), (452.7507629394531, 1027.022216796875), (456.5785217285156, 1005.364013671875), (461.5149841308594, 981.4533081054688), (467.5253601074219, 955.9459838867188), (473.7710876464844, 935.552734375), (482.0375061035156, 913.16552734375), (489.6884460449219, 895.2213745117188), (493.55914306640625, 885.0711059570312), (499.1692199707031, 870.5948486328125), (501.3037414550781, 859.32861328125), (504.2995910644531, 854.7980346679688), (505.3896789550781, 852.1510620117188), (505.2982177734375, 850.335693359375), (506.29681396484375, 850.335693359375)], 0.033000)
        post_action(1.670720)
        perform_click_event("Tap", 563.217773, 632.505859, 0.094000, "Activity")
        post_action(4.435381)
        perform_swipe_event([(514.2857055664062, 1090.1483154296875), (515.2654418945312, 1066.62109375), (517.4015502929688, 1047.100341796875), (519.6492919921875, 1023.3453369140625), (522.2324829101562, 1001.5975341796875), (525.6708374023438, 978.626953125), (526.2691040039062, 968.1375122070312), (527.2677001953125, 944.6367797851562), (528.2392578125, 935.5128784179688), (529.5227661132812, 925.2110595703125), (534.75732421875, 904.7930908203125), (541.4119262695312, 878.5763549804688), (546.936767578125, 858.2402954101562), (554.6507568359375, 836.8900756835938), (557.7815551757812, 830.2388305664062), (560.3938598632812, 822.840576171875), (565.2149658203125, 809.8673095703125), (567.8270874023438, 805.2922973632812), (571.3246459960938, 794.906494140625), (572.3146362304688, 792.0526123046875), (573.8845825195312, 787.7030029296875), (574.2025146484375, 786.6555786132812), (575.1328735351562, 786.3856201171875), (575.2011108398438, 783.9801025390625), (575.2011108398438, 784.38720703125)], 0.032500)
        post_action(2.755678)
        perform_swipe_event([(450.3744812011719, 1092.146728515625), (454.9161682128906, 1073.968994140625), (455.3675537109375, 1072.162353515625), (461.3592529296875, 1048.6806640625), (463.5216369628906, 1035.446533203125), (469.34814453125, 1012.209228515625), (473.058349609375, 999.9291381835938), (492.88006591796875, 930.2206420898438), (501.007568359375, 904.3809814453125), (514.1680297851562, 876.1748046875), (527.4653930664062, 845.6859130859375), (539.9539184570312, 822.801513671875), (545.2012939453125, 812.4482421875), (555.2288818359375, 796.87744140625), (561.3871459960938, 786.2188720703125), (562.4524536132812, 782.6878662109375), (565.81591796875, 778.1885375976562), (567.018798828125, 775.78125), (568.2108154296875, 771.2091674804688), (569.20947265625, 768.8992919921875), (570.2080688476562, 768.399658203125), (570.2080688476562, 766.90087890625), (571.2066650390625, 767.4004516601562), (571.2066650390625, 766.4012451171875)], 0.032500)
        post_action(0.486566)
        perform_swipe_event([(677.0596313476562, 831.3505249023438), (656.0888061523438, 832.3497314453125), (636.4454956054688, 835.1813354492188), (625.9634399414062, 835.347412109375), (608.0785522460938, 839.805419921875), (584.6722412109375, 846.89306640625), (562.6620483398438, 853.7574462890625), (551.1321411132812, 857.6974487304688), (533.01953125, 860.9823608398438), (524.4609985351562, 863.2623901367188), (517.4939575195312, 865.586181640625), (496.90692138671875, 870.2985229492188), (486.285400390625, 874.4285888671875), (468.5340576171875, 881.2422485351562), (457.6279296875, 883.9935302734375), (451.70196533203125, 886.1978759765625), (436.22210693359375, 891.971923828125), (429.42431640625, 893.2986450195312), (423.40447998046875, 895.3030395507812), (408.4327392578125, 900.296630859375), (402.4410400390625, 900.7962646484375), (397.0848083496094, 903.1353759765625), (387.5426330566406, 905.598876953125), (384.65081787109375, 906.5633544921875), (382.1327209472656, 906.959716796875), (379.5848693847656, 908.1784057617188), (379.47296142578125, 908.2904052734375), (377.97503662109375, 908.2904052734375), (377.8084716796875, 908.9566650390625), (376.31890869140625, 909.2896118164062), (375.33758544921875, 909.2896118164062), (374.4798889160156, 909.2896118164062), (373.5173645019531, 909.2896118164062), (373.4812927246094, 909.2896118164062)], 0.018000)
        post_action(0.836897)
        perform_swipe_event([(66.90707397460938, 946.2607421875), (114.4573974609375, 929.7168579101562), (132.0635986328125, 924.3922119140625), (177.07962036132812, 912.9553833007812), (212.16067504882812, 909.2896118164062), (230.0865936279297, 909.2896118164062), (259.9054260253906, 909.2896118164062), (274.1192932128906, 909.2896118164062), (299.2050476074219, 910.288818359375), (315.76513671875, 910.288818359375), (338.2357177734375, 910.288818359375), (351.0887451171875, 909.78076171875), (370.42584228515625, 909.2896118164062), (380.49566650390625, 909.2896118164062), (403.3242492675781, 905.8606567382812), (413.4177551269531, 903.4957885742188), (433.4571228027344, 899.280517578125), (440.5227355957031, 898.2789916992188), (450.3744812011719, 894.30126953125), (454.9075622558594, 893.6669921875), (462.8456115722656, 891.1409912109375), (466.2398681640625, 890.0088500976562), (472.298828125, 887.6549072265625), (475.05377197265625, 886.45068359375), (479.624267578125, 885.308349609375), (482.30926513671875, 885.308349609375), (482.3301086425781, 885.308349609375)], 0.033000)
        post_action(0.731239)
        perform_key_event(4)
        post_action(0.799494)
        perform_swipe_event([(462.35784912109375, 1133.11474609375), (473.97247314453125, 1082.7542724609375), (481.46881103515625, 1048.4017333984375), (495.28961181640625, 1002.6886596679688), (505.2904052734375, 956.2958984375), (512.6898193359375, 929.367431640625), (523.8001708984375, 893.073486328125), (534.092041015625, 867.4879150390625), (540.7489624023438, 855.8314208984375), (550.6680297851562, 836.8536376953125), (557.51318359375, 824.8380737304688), (565.9558715820312, 809.0694580078125), (576.3089599609375, 789.9414672851562), (583.397216796875, 778.0463256835938), (589.1817626953125, 767.4005126953125), (593.1135864257812, 762.4043579101562), (594.1747436523438, 760.4059448242188), (595.1734008789062, 757.9078369140625), (596.1719970703125, 758.407470703125), (597.1705932617188, 757.4082641601562)], 0.033000)
        post_action(1.132455)
        perform_swipe_event([(455.3675537109375, 1107.135009765625), (461.1630554199219, 1088.5782470703125), (468.18670654296875, 1049.2509765625), (477.1848449707031, 1013.7261962890625), (500.2890625, 936.9098510742188), (510.2509460449219, 909.41064453125), (521.2760009765625, 879.31298828125), (530.4075317382812, 860.0397338867188), (536.8114013671875, 850.5557250976562), (546.2261962890625, 834.3784790039062), (561.4154663085938, 812.65283203125), (567.3925170898438, 804.4641723632812), (581.9597778320312, 783.6969604492188), (585.187255859375, 778.391845703125), (596.986572265625, 762.6805419921875), (603.2777099609375, 754.1796264648438), (607.4850463867188, 749.0859985351562), (611.0619506835938, 744.5969848632812), (614.4597778320312, 741.1078491210938), (615.1456298828125, 739.4223022460938), (617.064208984375, 737.5025634765625), (618.1414794921875, 737.4238891601562)], 0.033000)
        post_action(0.881195)
        perform_click_event("Tap", 572.205261, 840.343506, 0.111000, "Activity")
        post_action(4.681479)
        perform_swipe_event([(542.2468872070312, 1128.11865234375), (536.5379028320312, 1099.6884765625), (536.2551879882812, 1086.7628173828125), (536.2551879882812, 1066.5550537109375), (536.2551879882812, 1050.179443359375), (537.9979248046875, 1032.50634765625), (539.2711791992188, 1011.0486450195312), (543.2137451171875, 986.9038696289062), (548.951171875, 962.679931640625), (553.23828125, 946.2408447265625), (557.22607421875, 930.273193359375), (563.9326171875, 905.5711669921875), (572.1620483398438, 882.4404296875), (578.6962890625, 866.8228149414062), (582.0947265625, 855.71875), (583.3624267578125, 850.6448974609375), (585.187255859375, 845.339599609375), (586.1858520507812, 844.662109375), (586.1858520507812, 844.34033203125), (586.1858520507812, 843.3411254882812)], 0.033000)
        post_action(0.869093)
        perform_swipe_event([(372.482666015625, 1137.111572265625), (386.4632568359375, 1108.13427734375), (400.8559265136719, 1077.5074462890625), (408.22894287109375, 1059.580322265625), (420.84326171875, 1032.3380126953125), (439.9671325683594, 988.156005859375), (452.32501220703125, 959.0186767578125), (465.8529968261719, 933.2708740234375), (494.55194091796875, 888.1038208007812), (505.304931640625, 866.8059692382812), (510.996826171875, 857.6234130859375), (517.8011474609375, 849.8157958984375), (521.7752685546875, 840.343505859375), (527.1663208007812, 835.3981323242188), (529.4099731445312, 831.0601196289062), (530.7719116210938, 828.8433837890625), (532.0468139648438, 826.5684814453125), (533.2593994140625, 826.3544311523438)], 0.033500)
        post_action(2.002294)
        perform_swipe_event([(346.51873779296875, 1139.110107421875), (370.1183166503906, 1099.8759765625), (385.1643981933594, 1064.919677734375), (404.0188903808594, 1010.287353515625), (421.64642333984375, 971.4978637695312), (439.68182373046875, 938.4796752929688), (453.57574462890625, 915.39013671875), (462.8571472167969, 900.7962036132812), (475.71270751953125, 882.936767578125), (481.7451477050781, 874.6952514648438), (484.8135681152344, 869.5091552734375), (494.56536865234375, 857.3272094726562), (496.9216613769531, 853.9151000976562), (502.0508117675781, 847.5896606445312), (501.3037414550781, 845.371826171875), (505.19561767578125, 843.4437866210938), (506.3522033691406, 842.3419189453125), (506.29681396484375, 842.3419189453125)], 0.033000)
        post_action(1.570284)
        perform_swipe_event([(499.3065185546875, 1095.1444091796875), (501.3037414550781, 1049.8873291015625), (520.0324096679688, 942.2452392578125), (547.4182739257812, 839.8081665039062), (557.69775390625, 819.9056396484375), (561.9851684570312, 810.3041381835938), (566.8712158203125, 800.0579833984375), (572.0314331054688, 791.7295532226562), (577.5648193359375, 783.0213012695312), (578.1969604492188, 780.889892578125), (579.195556640625, 779.525390625), (580.1942138671875, 778.06201171875), (580.1942138671875, 777.0977172851562), (581.1928100585938, 776.3934326171875)], 0.033000)
        post_action(0.569162)
        perform_swipe_event([(527.2677001953125, 1084.1529541015625), (531.26220703125, 1045.68310546875), (534.9331665039062, 996.108642578125), (542.5110473632812, 932.4199829101562), (546.168701171875, 908.7266845703125), (553.5170288085938, 883.261962890625), (560.07421875, 857.0700073242188), (564.6278076171875, 835.6990356445312), (570.7075805664062, 816.611328125), (572.5490112304688, 810.67822265625), (574.2025146484375, 804.4743041992188), (575.2011108398438, 799.897216796875), (576.19970703125, 797.876708984375), (577.1983642578125, 795.2958374023438), (577.1983642578125, 794.1539916992188), (578.6962890625, 793.3801879882812), (578.1969604492188, 792.3809204101562)], 0.033000)
        post_action(0.715625)
        perform_swipe_event([(592.1775512695312, 735.4254760742188), (580.47900390625, 770.542236328125), (576.515380859375, 800.6884765625), (566.2940063476562, 847.5675659179688), (559.748046875, 879.1912231445312), (548.4452514648438, 924.2431030273438), (540.8973388671875, 962.7079467773438), (537.753173828125, 988.2279663085938), (537.2538452148438, 996.3721313476562), (536.2551879882812, 1008.2321166992188), (536.2551879882812, 1014.5693359375), (536.2551879882812, 1016.032470703125), (535.2556762695312, 1018.2054443359375), (535.256591796875, 1021.7018432617188), (534.2579956054688, 1022.201416015625)], 0.033000)
        post_action(0.731184)
        perform_key_event(4)
        post_action(1.518523)
        perform_click_event("Tap", 672.066589, 119.906326, 0.140000, "Activity")
        post_action(1.032566)
        perform_click_event("Tap", 37.947296, 126.900856, 0.099000, "Activity")
        post_action(0.000000)

    except Exception as e:
        print(e)
        traceback_str = ''.join(traceback.format_tb(e.__traceback__))
        print(traceback_str)
    clean_up()
    