# coding=utf8

import os
import sys
import time
import json
import argparse
import traceback
import uiautomator2 as u2
sys.path.append(os.path.abspath(os.getcwd()))
sys.path.append(os.path.abspath(os.getcwd()))
from sara_script import util

frida_session = None
xml = None
view_hierarchy = None
save_path = None
action_count = 0
current_popup_window = None
curr_webview_address = None

device_id = "emulator-5554"
os.system('adb connect -s ' + device_id)
d = u2.connect(device_id)
print(d.info)


def log(desc):
    global action_count
    print('[ReplayAction]-%d: ' % action_count, desc)


def error_handler(func):
    def wrapper(message, data):
        if message['type'] == 'error':
            print('[Func]: %s, [Error-msg]: %s' % (func.__name__, message))
            print('[Func]: %s, [Error-des]: %s' % (func.__name__, message['description']))
            print('[Func]: %s, [Error-sta]: %s' % (func.__name__, message['stack']))
            print('[Func]: %s, [Error-dat]: %s' % (func.__name__, data))
            return None
        else:
            return func(message, data)
    return wrapper


def preprocess_path():
    global save_path
    if save_path is None:
        return False
    if not os.path.exists(save_path):
        os.mkdir(save_path)
    else:
        for file in os.listdir(save_path):
            os.remove(os.path.join(save_path, file))
    return True


def post_action(custom_interval):
    global xml
    global d
    global action_count
    global save_path
    global view_hierarchy

    print('[ReplayTimeInterval]-%d: %s' % (action_count, json.dumps({'interval': custom_interval})))
    if action_count > 0:
        time.sleep(1)
        if custom_interval > 0:
            time.sleep(custom_interval)
    xml = d.dump_hierarchy()
    xml = util.parse_xml(xml)
    activity = d.app_current()['activity']
    activity_filename = os.path.join(save_path, '_'.join(['activity', str(action_count) + '.txt']))
    screenshot_filename = os.path.join(save_path, '_'.join(['screenshot', str(action_count)]) + '.jpg')
    xml_filename = os.path.join(save_path, '_'.join(['ui', str(action_count)]) + '.xml')
    view_hierarchy_filename = os.path.join(save_path, '_'.join(['view_hierarchy', str(action_count)]) + '.xml')
    d.screenshot(screenshot_filename)
    util.save_xml(xml, xml_filename)
    with open(activity_filename, 'w') as f:
        f.write(activity)
    f.close()
    view_hierarchy, lxml_view_hierarchy = util.dump_view_hierarchy(d, view_hierarchy_filename)
    action_count += 1


def set_text(rid, bounds, text):
    global xml
    view = util.find_view(rid, bounds, xml)
    if view is None:
        print('TextView ' + rid + ' does not exist')
    else:
        if len(rid) > 0:
            d(resourceId=rid, focused=True).set_text(text)
        else:
            d(focused=True).set_text(text)
        log('[set_text]-%s' % json.dumps({'rid': rid, 'text': text, 'bounds': bounds}))


def press_soft_keyboard(key_name):
    global xml
    index = util.find_soft_key(key_name, xml)
    if index is None:
        raise Exception('Key ' + key_name + ' does not exist')
    key_x, key_y = index[0], index[1]
    d.click(key_x, key_y)
    log('[press_key]-%s' % json.dumps({'key_name': key_name}))


def hide_soft_keyboard():
    global xml
    if util.check_soft_keyboard(xml):
        print('Hide soft keyboard')
        d.press('back')
        log('[hide_keyboard]')


def record_popup_window():
    global current_popup_window
    current_popup_window = util.get_current_window(d)
    log('[record_popup_window]-%s' % json.dumps({'window': current_popup_window}))


def close_popup_window():
    global current_popup_window
    if current_popup_window is not None:
        window = util.get_current_window(d)
        if window == current_popup_window:
            d.press('back')
            log('[hide_popup_window]-%s' % json.dumps({'window': current_popup_window}))
            current_popup_window = None


@error_handler
def get_instrument_WebView_message(message, data):
    global curr_webview_address
    print('[WebView]: ', message)
    curr_webview_address = util.get_view_address(message['payload']['webview'])


def perform_click_event(tap_type, x, y, duration, view_type):
    global action_count
    global view_hierarchy

    if view_type == 'Activity':
        candidates = util.find_component_candidates(view_hierarchy, x, y)
        if tap_type == 'LongTap':
            d.long_click(x, y, duration)
        elif tap_type == 'Tap':
            d.long_click(x, y, duration)
        elif tap_type == 'DoubleTap':
            d.double_click(x, y, 0.1)

        log('[click]-%s' % json.dumps({'tap_type': tap_type, 'x': x, 'y': y, 'duration': duration, 'candidate': candidates, 'view_type': view_type}))

    else:
        # Dialog & PopupWindow
        # command `adb shell dumpsys activity top` fails to extract view hierarchy of Dialog & PopupWindow
        if tap_type == 'LongTap':
            d.long_click(x, y, duration)
        elif tap_type == 'Tap':
            d.long_click(x, y, duration)
        elif tap_type == 'DoubleTap':
            d.double_click(x, y, 0.1)
        log('[click]-%s' % json.dumps({'tap_type': tap_type, 'x': x, 'y': y, 'duration': duration, 'view_type': view_type}))


@error_handler
def get_instrument_view_message(message, data):
    print('[ReplayViewInstrumentation]: %s' % json.dumps(message))


def perform_swipe_event(pointers, duration=0.01):
    d.swipe_points(pointers, duration)
    log('[swipe]-%s' % json.dumps({'pointers': pointers, 'duration': duration}))


def perform_key_event(key_code):
    d.press(key_code)
    log('[press]-%s' % json.dumps({'key_code': key_code}))


def webview_set_text_with_u2(text):
    d(focused=True).set_text(text)
    log('[webview_set_text]-%s' % json.dumps({'text': text}))


@error_handler
def get_webview_set_text_message(message, data):
    print('[WebViewSetText]: ', message)

@error_handler
def get_instrument_chrome_client_message(message, data):
    print('[Console]: ', message)


if __name__ == '__main__':
    parser = argparse.ArgumentParser(description='Argument Parser')
    parser.add_argument('--path', help='save path', required=True)
    parser.add_argument('--package', help='package name', required=True)
    parser.add_argument('--main_activity', help='main activity name', required=True)
    args = parser.parse_args()
    save_path = args.path
    package_name = args.package
    activity_name = args.main_activity

    if not preprocess_path():
        print('Save path not found')
        sys.exit()

    os.system("adb shell am start -n "+package_name+"/"+activity_name)

    time.sleep(10)
    try:
        post_action(0)

        perform_click_event("Tap", 72.147034, 107.161621, 0.080000, "Activity")
        post_action(2.038942)
        perform_click_event("Tap", 495.147034, 1018.161621, 0.080000, "Activity")
        post_action(2.038942)
        perform_click_event("Tap", 332.538147, 16.986729, 0.072000, "Activity")
        post_action(3.857146)
        perform_click_event("Tap", 628.127625, 1085.152222, 0.085000, "Activity")
        post_action(1.131888)
        perform_click_event("Tap", 564.216370, 271.787659, 0.098000, "Activity")
        post_action(2.188413)
        perform_click_event("Tap", 373.481293, 1231.038208, 0.087000, "Activity")
        post_action(1.068726)
        perform_click_event("Tap", 377.475739, 785.386414, 0.099000, "Activity")
        post_action(2.100667)
        perform_click_event("Tap", 41.941750, 1262.014038, 0.138000, "Activity")
        post_action(1.125692)
        perform_click_event("Tap", 239.667130, 276.783752, 0.099000, "Activity")
        post_action(2.024623)
        perform_click_event("Tap", 275.617218, 1254.020264, 0.072000, "Activity")
        post_action(0.671663)
        perform_click_event("Tap", 440.388367, 604.527710, 0.085000, "Activity")
        post_action(1.021128)
        perform_swipe_event([(340.52703857421875, 716.4403076171875), (371.4613342285156, 715.1505126953125), (387.34625244140625, 713.1544189453125), (402.2198181152344, 712.4434204101562), (421.12255859375, 709.4874877929688), (439.8890686035156, 706.94775390625), (452.7975769042969, 703.7124633789062), (464.1535949707031, 700.053955078125), (477.0773010253906, 696.9075317382812), (486.50537109375, 693.662841796875), (496.3076477050781, 691.127685546875), (502.12835693359375, 689.048828125), (510.3632507324219, 687.4389038085938), (516.204833984375, 685.157470703125), (521.7753295898438, 682.9664306640625), (524.5808715820312, 681.4675903320312), (526.5172729492188, 679.2208862304688), (528.1835327148438, 679.4691772460938), (528.2662963867188, 679.4691772460938), (529.264892578125, 679.4691772460938), (528.3378295898438, 679.4691772460938), (528.2662963867188, 679.4691772460938), (527.2677001953125, 679.4691772460938), (524.2718505859375, 679.4691772460938), (522.923583984375, 680.4683837890625), (520.0732421875, 681.671875), (518.9367065429688, 681.4675903320312), (516.580078125, 682.466796875), (515.3927001953125, 682.466796875), (513.8049926757812, 682.466796875), (513.287109375, 682.466796875), (512.4273071289062, 683.3272094726562), (512.2885131835938, 683.466064453125), (511.2898864746094, 683.466064453125), (511.2898864746094, 682.466796875), (513.0535888671875, 681.4675903320312), (516.646728515625, 680.4683837890625), (518.8087158203125, 679.4691772460938), (520.7767333984375, 679.4691772460938), (521.2760009765625, 677.9703369140625), (522.274658203125, 678.469970703125), (523.2732543945312, 678.469970703125), (524.2718505859375, 678.469970703125), (525.2704467773438, 678.469970703125)], 0.033000)
        post_action(7.074199)
        perform_click_event("Tap", 267.628296, 1242.029663, 0.095000, "Activity")
        post_action(0.746960)
        perform_click_event("Tap", 441.386963, 726.432495, 0.095000, "Activity")
        post_action(2.901979)
        perform_swipe_event([(373.4812927246094, 834.34814453125), (395.4507751464844, 823.3567504882812), (404.43829345703125, 819.35986328125), (418.8748779296875, 815.4534912109375), (419.41748046875, 815.3629760742188), (424.4105529785156, 812.3653564453125), (428.4049987792969, 811.3660888671875), (432.3994445800781, 811.3660888671875), (434.39666748046875, 810.3668823242188), (437.693359375, 810.3668823242188), (438.7435607910156, 809.36767578125), (440.37493896484375, 809.36767578125), (440.38836669921875, 809.36767578125), (441.386962890625, 809.36767578125), (443.3841857910156, 809.36767578125), (444.6354064941406, 809.36767578125), (445.3814392089844, 809.36767578125), (447.1746826171875, 808.3684692382812), (450.5058898925781, 807.3692626953125), (452.8710021972656, 806.3699951171875), (454.2776184082031, 805.3707885742188), (455.3675537109375, 804.37158203125), (457.86407470703125, 804.37158203125), (458.3634033203125, 803.3723754882812), (459.36199951171875, 803.3723754882812), (460.3606262207031, 802.5097045898438), (460.3606262207031, 802.3731689453125), (461.3592224121094, 802.3731689453125), (462.35784912109375, 802.3731689453125)], 0.033000)
        post_action(0.885041)
        perform_click_event("Tap", 277.614441, 1266.010986, 0.082000, "Activity")
        post_action(0.794352)
        perform_click_event("Tap", 441.386963, 725.433228, 0.086000, "Activity")
        post_action(1.751198)
        perform_swipe_event([(368.48822021484375, 843.3411254882812), (391.4563293457031, 838.3450317382812), (401.44244384765625, 837.3458251953125), (408.4327392578125, 836.3466186523438), (414.4244079589844, 835.347412109375), (421.91400146484375, 835.347412109375), (419.41748046875, 835.347412109375), (423.41192626953125, 835.347412109375), (429.6888122558594, 834.705078125), (433.27337646484375, 833.4736938476562), (436.8711853027344, 833.3489379882812), (440.0360107421875, 832.3497314453125), (441.386962890625, 831.3505249023438), (445.2956237792969, 831.3505249023438), (448.1110534667969, 829.618408203125), (451.65240478515625, 829.35205078125), (452.8710021972656, 829.35205078125), (454.86822509765625, 828.3528442382812), (455.3675537109375, 828.3528442382812), (456.3661804199219, 828.3528442382812), (457.3647766113281, 827.3536376953125), (458.3634033203125, 827.3536376953125), (459.36199951171875, 827.3536376953125), (460.42523193359375, 826.3544311523438), (461.3592224121094, 826.3544311523438), (461.3592224121094, 825.3551635742188), (462.35784912109375, 825.3551635742188), (463.3564453125, 825.3551635742188), (464.3550720214844, 824.35595703125)], 0.033000)
        post_action(0.651844)
        perform_click_event("Tap", 282.607483, 1255.019531, 0.025000, "Activity")
        post_action(0.745759)
        perform_click_event("Tap", 472.343964, 718.438721, 0.095000, "Activity")
        post_action(1.000483)
        perform_swipe_event([(480.3328857421875, 858.3294067382812), (459.36199951171875, 862.3262939453125), (449.2171936035156, 865.7099609375), (449.28973388671875, 865.6340942382812), (436.96142578125, 868.9290771484375), (427.1479187011719, 872.0715942382812), (422.3406066894531, 872.7327270507812), (420.4161071777344, 873.3177490234375), (416.0692138671875, 875.6687622070312), (413.2283020019531, 876.9137573242188), (409.7184143066406, 878.1702270507812), (406.1176452636719, 879.3130493164062), (404.7207946777344, 880.312255859375), (401.57037353515625, 881.3114624023438), (399.29461669921875, 882.3106689453125), (399.4452209472656, 883.3099365234375), (396.47930908203125, 884.3091430664062), (395.9500732421875, 884.3091430664062), (395.4507751464844, 885.308349609375), (394.4521484375, 885.308349609375), (393.45355224609375, 885.308349609375), (394.4521484375, 885.308349609375), (395.4507751464844, 885.308349609375), (398.17510986328125, 885.308349609375), (399.9274597167969, 885.308349609375), (401.8722839355469, 885.308349609375), (403.41717529296875, 885.308349609375), (406.4157409667969, 885.308349609375), (407.4288024902344, 885.308349609375), (410.92926025390625, 884.3091430664062), (413.2113037109375, 883.3099365234375), (415.66741943359375, 882.3106689453125), (419.6026306152344, 881.3114624023438), (421.41473388671875, 881.3114624023438), (422.8153076171875, 881.3114624023438), (423.9112243652344, 879.8126220703125), (426.4630126953125, 880.312255859375), (427.7762451171875, 879.3130493164062), (428.4049987792969, 879.3130493164062), (429.40362548828125, 879.3130493164062), (430.4022216796875, 879.3130493164062)], 0.033000)
        post_action(0.474976)
        perform_click_event("Tap", 275.617218, 1254.020264, 0.068000, "Activity")
        post_action(0.777131)
        perform_click_event("Tap", 449.375885, 720.437134, 0.099000, "Activity")
        post_action(0.937492)
        perform_swipe_event([(313.56451416015625, 918.2825927734375), (337.8516845703125, 909.024658203125), (334.5353698730469, 910.288818359375), (339.4413146972656, 909.3070678710938), (360.9888916015625, 904.8779907226562), (364.4937744140625, 903.2943115234375), (368.48822021484375, 903.2943115234375), (371.48406982421875, 902.2951049804688), (377.2666015625, 900.4012451171875), (379.82098388671875, 898.94921875), (381.17889404296875, 899.2974243164062), (382.37017822265625, 899.2974243164062), (382.46881103515625, 898.3787841796875), (384.96533203125, 898.2982177734375), (385.4646301269531, 897.2990112304688), (386.4632568359375, 897.2990112304688), (387.46185302734375, 897.2990112304688), (388.4604797363281, 897.2990112304688), (389.4591064453125, 897.2990112304688), (388.4604797363281, 896.2997436523438), (387.23724365234375, 897.5237426757812), (385.9639587402344, 897.2990112304688), (385.7008972167969, 897.2990112304688), (383.8699951171875, 897.2990112304688), (382.4367370605469, 897.2990112304688), (379.0050354003906, 898.7664184570312), (377.939697265625, 898.8331909179688), (374.4523010253906, 900.32421875), (369.818359375, 901.6295776367188), (365.49237060546875, 902.7947387695312), (360.1446533203125, 903.2943115234375), (358.22869873046875, 905.5662841796875), (353.75390625, 907.168701171875), (351.7159118652344, 908.1882934570312), (346.51873779296875, 909.7891845703125), (342.86029052734375, 909.2896118164062), (340.38665771484375, 910.288818359375), (338.07745361328125, 911.2880249023438), (335.05303955078125, 913.0275268554688), (330.9649353027344, 914.2857055664062), (327.8311462402344, 916.6406860351562), (321.61505126953125, 918.2825927734375), (317.2851257324219, 920.5549926757812), (314.06378173828125, 921.7799072265625), (294.5908508300781, 924.2778930664062), (293.5922546386719, 924.2778930664062), (292.5936279296875, 924.2778930664062), (291.5950012207031, 924.2778930664062), (290.09710693359375, 925.277099609375), (288.6625061035156, 925.277099609375), (286.18768310546875, 925.277099609375), (284.1054382324219, 925.277099609375), (280.56048583984375, 926.2763671875), (278.43719482421875, 926.2763671875), (276.8586120605469, 926.2763671875), (274.58294677734375, 926.2763671875), (273.6199645996094, 926.2763671875), (271.75616455078125, 926.2763671875), (270.6139221191406, 926.2763671875), (269.6255187988281, 926.2763671875), (268.6269226074219, 926.2763671875), (267.6282958984375, 926.2763671875), (266.94781494140625, 926.2763671875), (266.1304016113281, 926.2763671875), (265.6310729980469, 926.2763671875), (265.6310729980469, 925.277099609375), (266.3791809082031, 924.2778930664062), (268.88720703125, 922.01904296875), (271.0135803222656, 920.890625), (272.4274597167969, 920.4750366210938), (274.61859130859375, 918.2846069335938), (275.91668701171875, 918.2825927734375), (276.6158142089844, 916.7838134765625), (278.0975341796875, 917.2833862304688), (278.613037109375, 916.2841796875), (279.6116638183594, 916.2841796875), (280.6102600097656, 916.2841796875), (280.6102600097656, 914.7852783203125), (282.5807800292969, 915.284912109375), (282.60748291015625, 915.284912109375), (283.6061096191406, 915.284912109375), (284.5408630371094, 914.2857055664062), (285.10406494140625, 914.2857055664062), (285.60333251953125, 914.2857055664062), (286.6019592285156, 914.2857055664062), (287.6005554199219, 914.2857055664062)], 0.033000)
        post_action(3.876557)
        perform_click_event("Tap", 284.604736, 1243.028931, 0.095000, "Activity")
        post_action(0.815262)
        perform_click_event("Tap", 474.341217, 715.441040, 0.086000, "Activity")
        post_action(1.085495)
        perform_swipe_event([(324.54925537109375, 961.2490234375), (357.50347900390625, 944.761962890625), (352.8522644042969, 947.4410400390625), (355.5062561035156, 946.2607421875), (370.2579345703125, 940.3564453125), (372.4314880371094, 939.6600952148438), (378.66912841796875, 937.1898193359375), (378.4743347167969, 937.2677612304688), (383.4674072265625, 935.2693481445312), (386.4632568359375, 934.2700805664062)], 0.033000)
        post_action(0.931191)
        perform_swipe_event([(451.37310791015625, 940.2654418945312), (376.5837097167969, 959.2506103515625), (372.49908447265625, 960.2498168945312), (370.1909484863281, 961.89599609375), (366.0559997558594, 963.465087890625), (361.8101806640625, 964.2467041015625), (358.6900939941406, 965.2459106445312), (355.10174560546875, 966.6498413085938), (349.7331237792969, 967.2443237304688), (347.45703125, 968.2435302734375), (343.2982177734375, 970.2420043945312), (340.6365051269531, 971.2412109375), (338.5298156738281, 972.2404174804688), (336.5325927734375, 973.956298828125), (334.60797119140625, 974.2388916015625), (334.5353698730469, 974.2388916015625), (334.5353698730469, 973.0514526367188), (334.5353698730469, 973.2396850585938), (334.5353698730469, 971.7407836914062), (336.2801513671875, 971.4938354492188), (337.31591796875, 970.4574584960938), (338.5488586425781, 969.2237548828125), (344.927001953125, 966.7760009765625), (350.1941833496094, 964.4063110351562), (355.55181884765625, 963.2246704101562), (360.0769348144531, 961.2490234375), (364.1514587402344, 960.2498168945312), (369.06878662109375, 959.2506103515625), (372.7931213378906, 958.2513427734375), (377.2418518066406, 958.2513427734375), (382.41546630859375, 957.2521362304688), (384.44952392578125, 956.2529296875), (389.3891296386719, 955.2887573242188), (393.6941223144531, 955.2537231445312), (397.1399841308594, 954.2545166015625), (400.4083251953125, 952.7733764648438), (403.23529052734375, 953.2552490234375), (406.21307373046875, 952.2560424804688), (407.39532470703125, 951.295654296875), (409.7012939453125, 951.2568359375), (410.92926025390625, 951.2568359375), (411.4285888671875, 951.2568359375), (412.42718505859375, 950.2576293945312), (413.4258117675781, 950.2576293945312), (414.4244079589844, 950.2576293945312), (414.4244079589844, 951.2568359375), (415.42303466796875, 951.2568359375), (414.2895812988281, 951.2568359375)], 0.033000)
        post_action(0.722219)
        perform_click_event("Tap", 277.614441, 1243.028931, 0.081000, "Activity")
        post_action(0.717171)
        perform_click_event("Tap", 458.363403, 733.427002, 0.069000, "Activity")
        post_action(1.017029)
        perform_swipe_event([(283.6061096191406, 876.3153686523438), (307.57281494140625, 865.323974609375), (316.5603332519531, 862.3262939453125), (318.319091796875, 861.9743041992188), (326.5464782714844, 860.327880859375), (334.5353698730469, 858.3294067382812), (340.6754455566406, 857.1006469726562), (342.7997741699219, 856.5119018554688), (343.52288818359375, 856.3309936523438), (350.51318359375, 853.8330078125), (355.37615966796875, 854.3325805664062), (358.59161376953125, 853.3333129882812), (361.1595153808594, 852.6727294921875), (364.415283203125, 852.3341064453125), (367.8648986816406, 852.3341064453125), (369.4868469238281, 851.3348999023438), (370.9847412109375, 851.3348999023438), (371.48406982421875, 851.3348999023438), (372.9819641113281, 851.3348999023438), (373.4812927246094, 851.3348999023438)], 0.033000)
        post_action(0.837887)
        perform_swipe_event([(497.3092956542969, 867.3223876953125), (475.3398132324219, 870.320068359375), (461.8585205078125, 874.8165893554688), (456.89764404296875, 876.8653564453125), (458.3634033203125, 876.3153686523438), (446.3360595703125, 880.329833984375), (439.9451904296875, 882.8876953125), (436.27874755859375, 884.8663330078125), (429.9139709472656, 885.308349609375), (425.8818054199219, 887.5698852539062), (420.5530700683594, 890.1674194335938), (416.1255187988281, 891.4517822265625), (412.42718505859375, 892.3028564453125), (409.43878173828125, 894.3013305664062), (406.2973327636719, 896.43798828125), (402.73944091796875, 897.2990112304688), (399.469970703125, 899.2850341796875), (398.0109558105469, 900.7326049804688), (394.63067626953125, 902.116455078125), (393.47503662109375, 903.2728271484375), (391.15252685546875, 904.5975341796875), (389.89752197265625, 904.8540649414062), (387.64569091796875, 905.292724609375), (386.3216552734375, 906.4336547851562), (385.4646301269531, 907.53759765625), (383.8383483886719, 907.2911987304688), (381.60101318359375, 908.2904052734375), (380.9864807128906, 908.2904052734375), (378.9736328125, 909.2896118164062), (379.47296142578125, 909.2896118164062), (382.46881103515625, 907.2911987304688), (384.4660339355469, 906.2919311523438), (385.4646301269531, 906.2919311523438), (385.4646301269531, 905.292724609375), (386.4632568359375, 905.292724609375), (387.46185302734375, 906.1383056640625), (387.46185302734375, 906.79150390625), (388.4106140136719, 906.2919311523438), (388.4604797363281, 906.2919311523438), (387.46185302734375, 906.2919311523438), (386.4857177734375, 906.2919311523438), (384.96533203125, 907.7908325195312), (382.70648193359375, 909.0518188476562), (379.0146484375, 909.2896118164062), (378.4743347167969, 910.288818359375), (374.6320495605469, 911.2880249023438), (372.03863525390625, 912.2872924804688), (370.0084228515625, 913.7637939453125), (368.3774108886719, 914.2857055664062), (364.6925048828125, 915.68505859375), (360.773193359375, 917.0093383789062), (359.5757141113281, 917.2833862304688), (359.5007019042969, 918.7822265625), (358.5020751953125, 918.2825927734375), (358.5020751953125, 919.7813720703125), (358.5020751953125, 918.2825927734375), (359.5007019042969, 918.2825927734375), (360.49932861328125, 916.2841796875), (362.7199401855469, 915.0614013671875), (366.1137390136719, 914.4744262695312), (368.5858459472656, 914.2857055664062), (371.9833984375, 913.2864990234375), (374.40606689453125, 913.2864990234375), (375.97784423828125, 911.7877197265625), (377.97503662109375, 912.2872924804688), (378.4743347167969, 912.2872924804688), (379.47296142578125, 912.2872924804688), (379.47296142578125, 910.9625854492188), (380.4715881347656, 911.2880249023438)], 0.033000)
        post_action(3.671636)
        perform_click_event("Tap", 62.912624, 1245.027344, 0.112000, "Activity")
        post_action(2.070074)
        perform_click_event("Tap", 557.226074, 443.653381, 0.081000, "Activity")
        post_action(1.600739)
        perform_swipe_event([(262.6352233886719, 879.3130493164062), (295.5894775390625, 861.3270263671875), (291.9447326660156, 864.3845825195312), (306.5830078125, 860.6589965820312), (306.7988586425781, 860.6110229492188), (317.7889404296875, 857.5865478515625), (326.0529479980469, 855.163330078125), (332.0388488769531, 855.331787109375), (332.88983154296875, 854.65625), (334.5353698730469, 854.3325805664062), (335.66845703125, 854.3325805664062), (338.2559814453125, 854.3325805664062), (339.5265808105469, 854.3325805664062), (340.86102294921875, 852.9990844726562), (341.5256652832031, 853.3333129882812), (343.02362060546875, 853.3333129882812), (344.536865234375, 853.3333129882812), (345.5201110839844, 853.3333129882812), (347.3355712890625, 853.3333129882812), (348.5159606933594, 853.3333129882812), (349.5145568847656, 853.3333129882812), (351.8316955566406, 853.3333129882812), (354.6021728515625, 853.3333129882812), (356.9718322753906, 854.3325805664062), (359.25018310546875, 854.3325805664062), (364.07879638671875, 855.331787109375), (368.22216796875, 855.331787109375), (374.4179382324219, 856.3309936523438), (377.44189453125, 856.3309936523438), (383.96673583984375, 857.829833984375), (391.8125915527344, 857.3302001953125), (400.4507141113281, 856.3309936523438), (408.8687438964844, 854.72314453125), (416.9334411621094, 853.4956665039062), (423.2257385253906, 850.928466796875), (429.86248779296875, 849.8495483398438), (435.5947265625, 848.2374267578125), (440.23870849609375, 846.9132690429688), (441.71636962890625, 846.6736450195312), (446.2465515136719, 846.3388061523438), (450.1499328613281, 846.3388061523438), (451.8724365234375, 846.3388061523438), (453.3183898925781, 845.339599609375), (454.6069030761719, 845.339599609375), (456.865478515625, 845.339599609375), (458.3634033203125, 845.339599609375), (459.36199951171875, 845.339599609375), (460.3606262207031, 844.56005859375), (460.3606262207031, 843.8406982421875), (461.3592224121094, 844.34033203125), (460.3606262207031, 843.3411254882812), (459.36199951171875, 843.3411254882812), (457.09686279296875, 842.0738525390625), (454.4978942871094, 842.3419189453125), (452.8894348144531, 842.3419189453125), (449.87518310546875, 842.3419189453125), (446.3952941894531, 842.3419189453125), (443.251708984375, 842.3419189453125), (439.67864990234375, 843.3411254882812), (435.4303894042969, 844.32275390625), (432.75421142578125, 844.34033203125), (430.0164794921875, 845.7255859375), (426.4129638671875, 845.339599609375), (424.1062316894531, 846.3388061523438), (420.9154052734375, 847.3380126953125), (419.41748046875, 848.3372192382812), (418.1396789550781, 848.3372192382812), (414.7958679199219, 849.33642578125), (412.5701904296875, 849.33642578125), (409.9783935546875, 850.7875366210938), (408.93206787109375, 850.335693359375), (406.49664306640625, 851.2737426757812), (404.33758544921875, 851.3348999023438), (400.44384765625, 852.3341064453125), (398.9615783691406, 853.8172607421875), (398.4466247558594, 853.3333129882812), (397.0025939941406, 853.3333129882812), (395.5106201171875, 854.3325805664062), (394.4521484375, 854.3325805664062), (393.45355224609375, 854.3325805664062), (392.4549255371094, 854.3325805664062), (391.4563293457031, 855.331787109375), (389.8617248535156, 855.331787109375), (387.961181640625, 855.331787109375), (385.0389709472656, 856.3309936523438), (382.46881103515625, 856.3309936523438), (379.56396484375, 857.3302001953125), (377.3994140625, 858.3294067382812), (375.0668029785156, 858.7413940429688), (371.48406982421875, 859.3286743164062), (366.0131530761719, 860.327880859375), (360.53094482421875, 860.327880859375), (357.5765075683594, 862.2532348632812), (353.0663757324219, 862.3262939453125), (348.51593017578125, 863.3255004882812), (343.407958984375, 864.3247680664062), (341.3412780761719, 865.323974609375), (337.7619934082031, 866.09228515625), (335.4886474609375, 866.3231811523438), (332.0486145019531, 867.3223876953125), (329.666015625, 868.3215942382812), (327.501953125, 868.3215942382812), (326.04718017578125, 868.3215942382812), (326.5464782714844, 867.3223876953125), (327.86834716796875, 867.3223876953125), (330.9027404785156, 865.642578125), (335.3510437011719, 864.4163208007812), (340.52703857421875, 862.8258666992188), (345.8981628417969, 861.6375732421875), (352.02569580078125, 861.3270874023438), (357.97607421875, 860.327880859375), (360.2696228027344, 860.327880859375), (365.1763610839844, 858.9871826171875), (369.272216796875, 859.3286743164062), (372.48785400390625, 858.3294067382812), (375.7815856933594, 857.3302001953125), (377.97503662109375, 857.3302001953125), (379.47296142578125, 855.8314208984375), (381.72174072265625, 856.3309936523438), (383.3785095214844, 856.3309936523438), (385.5830993652344, 855.331787109375), (387.9611511230469, 855.331787109375), (390.4151916503906, 854.3751220703125), (391.4563293457031, 854.3325805664062), (392.4549255371094, 854.3325805664062), (393.45355224609375, 854.3325805664062), (394.4521484375, 854.3325805664062), (395.4507751464844, 854.3325805664062), (396.4493713378906, 854.3325805664062), (397.447998046875, 854.3325805664062), (398.4466247558594, 854.3325805664062)], 0.033000)
        post_action(1.020309)
        perform_click_event("Tap", 68.904305, 1254.020264, 0.137000, "Activity")
        post_action(1.544053)
        perform_click_event("Tap", 538.252441, 1059.172485, 0.080000, "Activity")
        post_action(1.948024)
        perform_swipe_event([(443.3841857910156, 1012.209228515625), (419.41748046875, 1002.217041015625), (406.006591796875, 994.7620239257812), (401.44244384765625, 992.2247924804688), (387.2034912109375, 984.0759887695312), (380.62664794921875, 981.4953002929688), (372.482666015625, 975.7376708984375), (362.0846862792969, 971.03515625), (358.4502868652344, 969.8916625976562), (352.4092712402344, 966.54443359375), (344.77099609375, 963.3306274414062), (337.0318908691406, 959.2506103515625), (330.4231262207031, 957.5458984375), (321.8817443847656, 952.919921875), (316.56036376953125, 948.2591552734375), (308.23565673828125, 945.4826049804688), (299.4221496582031, 941.8768310546875), (293.38128662109375, 938.8627319335938), (287.9825439453125, 935.524169921875), (280.4598388671875, 932.1713256835938), (274.61859130859375, 925.7767333984375), (266.12091064453125, 919.77197265625), (258.66839599609375, 914.6371459960938), (255.2356414794922, 909.8792724609375), (253.74127197265625, 909.2896118164062), (251.46206665039062, 907.1026611328125), (250.15255737304688, 905.7922973632812), (249.65325927734375, 905.292724609375)], 0.033000)
        post_action(1.001603)
        perform_swipe_event([(336.5325927734375, 864.3247680664062), (353.0758972167969, 877.868408203125), (358.5020751953125, 882.3106689453125), (369.4868469238281, 892.3028564453125), (382.5007629394531, 905.1635131835938), (390.55877685546875, 912.3739624023438), (398.9459228515625, 919.7814331054688), (403.1475830078125, 924.9848022460938), (407.0184020996094, 928.56640625), (410.1124572753906, 933.6346435546875), (414.2133483886719, 937.0565795898438), (418.41888427734375, 942.263916015625), (421.0879821777344, 946.6060791015625), (424.72772216796875, 951.57421875), (428.3481140136719, 954.7256469726562), (430.9309997558594, 958.0162963867188), (433.70355224609375, 961.8602905273438), (434.77783203125, 963.6288452148438), (436.3939514160156, 966.2451782226562), (437.69268798828125, 967.2443237304688), (438.89044189453125, 968.2435302734375), (439.3897399902344, 969.2427978515625), (439.3897399902344, 970.2420043945312), (440.38836669921875, 971.1351318359375), (440.38836669921875, 971.7343139648438), (440.38836669921875, 972.2404174804688), (439.3897399902344, 972.2404174804688), (436.8733215332031, 970.9814453125), (432.39947509765625, 968.7431640625), (422.0508117675781, 963.0660400390625), (411.100830078125, 957.8089599609375), (395.8831481933594, 949.2137451171875), (381.280517578125, 940.138916015625), (368.60711669921875, 933.3104858398438), (356.1326599121094, 924.7479858398438), (343.39111328125, 917.1954956054688), (331.0402526855469, 909.7891845703125), (319.31048583984375, 902.8977661132812), (305.6503601074219, 894.0181274414062), (296.5502014160156, 886.2697143554688), (289.95635986328125, 880.6710815429688), (282.1209716796875, 872.8309326171875), (276.9447326660156, 866.311279296875), (270.1706848144531, 859.0261840820312), (263.21392822265625, 850.9147338867188), (257.092529296875, 842.0166015625), (249.70130920410156, 834.7133178710938), (244.8795928955078, 827.1832885742188), (239.6530303955078, 819.3386840820312), (236.37103271484375, 812.4632568359375), (231.42691040039062, 807.4916381835938), (226.33816528320312, 801.0266723632812), (222.14430236816406, 794.5584716796875), (216.9618682861328, 788.6470947265625), (214.53836059570312, 785.2228393554688), (209.708740234375, 781.3895263671875), (206.68809509277344, 777.3677978515625), (202.3709259033203, 774.0473022460938), (198.97647094726562, 771.6499633789062), (196.72677612304688, 769.3759765625), (193.26939392089844, 766.9386596679688), (189.00302124023438, 763.5362548828125), (185.69386291503906, 762.4043579101562), (182.24688720703125, 761.4051513671875), (177.8770751953125, 759.53076171875), (175.4207305908203, 759.40673828125), (174.0405731201172, 759.40673828125), (172.2607421875, 759.40673828125), (170.26351928710938, 759.40673828125), (167.04934692382812, 761.1240234375), (162.3721160888672, 763.6046142578125), (159.22317504882812, 765.4020385742188), (156.97935485839844, 767.2032470703125), (155.78363037109375, 768.7871704101562), (152.90545654296875, 770.8388671875), (149.7333221435547, 773.4544677734375), (145.06089782714844, 776.761962890625), (140.804443359375, 779.8907470703125), (136.58401489257812, 781.3895263671875), (135.31207275390625, 782.8883056640625), (133.8761444091797, 783.3880004882812), (133.81414794921875, 783.3880004882812)], 0.033000)
        post_action(0.615899)
        perform_swipe_event([(305.5755920410156, 499.60968017578125), (308.3074035644531, 518.7437744140625), (316.06103515625, 547.572265625), (321.03369140625, 570.6918334960938), (326.4190673828125, 592.8988647460938), (334.03607177734375, 617.0179443359375), (340.73760986328125, 639.6588745117188), (346.9092712402344, 659.0493774414062), (352.6188659667969, 670.8016967773438), (358.095703125, 684.2445678710938), (366.897705078125, 700.9151611328125), (374.1207275390625, 713.6295776367188), (379.5636291503906, 725.6146240234375), (386.5044250488281, 734.8142700195312), (391.95562744140625, 739.4223022460938), (394.6507568359375, 743.617919921875), (395.7451171875, 745.7122192382812), (399.209228515625, 749.1783447265625), (401.8174743652344, 754.9735717773438), (408.93206787109375, 764.9024047851562), (419.4369201660156, 776.417724609375), (427.0502624511719, 787.189208984375), (434.8862609863281, 795.61376953125), (439.4310302734375, 800.3953247070312), (441.8514099121094, 805.301025390625), (447.10491943359375, 811.0921630859375), (452.4420166015625, 815.433349609375), (457.36480712890625, 820.3590698242188), (461.2065734863281, 824.2031860351562), (464.9979248046875, 828.99609375), (467.0285339355469, 831.0278930664062), (468.3495178222656, 833.2432861328125), (469.34814453125, 834.8477783203125), (470.8460388183594, 834.34814453125), (471.5171813964844, 835.347412109375), (471.3453674316406, 835.347412109375)], 0.033000)
        post_action(0.484048)
        perform_swipe_event([(135.81137084960938, 788.3840942382812), (151.7891845703125, 769.39892578125), (160.77670288085938, 757.4082641601562), (164.77114868164062, 755.4098510742188), (175.51597595214844, 745.6097412109375), (184.56109619140625, 740.01318359375), (192.23300170898438, 735.925048828125), (200.790283203125, 731.4113159179688), (206.0301971435547, 729.2720947265625), (210.45054626464844, 728.430908203125), (212.69639587402344, 728.430908203125), (214.2025146484375, 728.430908203125), (215.52549743652344, 727.4317016601562), (217.19833374023438, 727.4317016601562), (218.2635955810547, 727.4317016601562), (221.34654235839844, 727.4317016601562), (225.26409912109375, 727.4317016601562), (229.9872589111328, 727.4317016601562), (235.31398010253906, 726.4324951171875), (241.15896606445312, 726.4324951171875), (245.94970703125, 726.4324951171875), (252.02288818359375, 725.3090209960938), (257.9684753417969, 725.4332275390625), (261.1138610839844, 725.4332275390625), (265.18817138671875, 724.4340209960938), (270.7679138183594, 723.0537719726562)], 0.033000)
        post_action(0.633312)
        perform_swipe_event([(481.33148193359375, 831.3505249023438), (481.33148193359375, 812.8654174804688), (482.7135009765625, 795.9230346679688), (483.7574157714844, 786.5220947265625), (484.32733154296875, 783.3880004882812), (485.3259582519531, 777.3926391601562), (486.3245544433594, 772.3965454101562), (488.32177734375, 764.0087280273438), (490.6124572753906, 762.1107177734375), (492.21453857421875, 756.612548828125), (494.448974609375, 753.1402587890625), (496.80999755859375, 749.9141845703125), (498.3371276855469, 746.3876342773438), (499.4622497558594, 745.4176635742188), (501.03173828125, 741.6929321289062), (501.3037414550781, 739.4094848632812), (502.3023681640625, 737.9569702148438), (503.780517578125, 736.944091796875), (504.2995910644531, 736.417724609375), (505.2982177734375, 736.4246826171875), (505.2982177734375, 735.4254760742188)], 0.033500)
        post_action(0.451713)
        perform_swipe_event([(257.6421813964844, 723.434814453125), (237.0916748046875, 751.8549194335938), (230.74952697753906, 761.3071899414062), (230.6796112060547, 761.4051513671875), (219.72154235839844, 775.751220703125), (213.72535705566406, 784.3650512695312), (208.7101287841797, 791.88134765625), (204.8934783935547, 798.0204467773438), (201.45181274414062, 803.9087524414062), (198.0710906982422, 810.328369140625), (195.83949279785156, 814.1409912109375), (191.75755310058594, 821.8220825195312), (189.4026641845703, 826.6884155273438), (186.59181213378906, 832.6475830078125), (184.26377868652344, 836.3073120117188), (183.7447967529297, 837.110107421875), (182.24688720703125, 838.8446044921875), (182.74618530273438, 839.34423828125)], 0.033000)
        post_action(1.325845)
        perform_click_event("Tap", 53.925106, 1257.017944, 0.113000, "Activity")
        post_action(2.086044)
        perform_click_event("Tap", 262.635223, 594.535522, 0.070000, "Activity")
        post_action(2.032115)
        perform_click_event("Tap", 168.765610, 1122.123291, 0.111000, "Activity")
        post_action(2.032115)
        perform_swipe_event([(362.4965515136719, 641.4988403320312), (381.4701843261719, 637.501953125),(387.6576232910156, 635.9541625976562), (389.4591064453125, 635.5035400390625),(395.3854675292969, 634.6563720703125), (396.4493713378906, 634.5042724609375), (400.8575439453125, 633.2440185546875), (403.4396667480469, 632.505859375),(409.67181396484375, 631.2586669921875), (408.4327392578125, 631.5066528320312),  (413.4258117675781, 630.5073852539062), (417.9195556640625, 630.5073852539062), (419.35662841796875, 629.5081787109375), (419.9167785644531, 629.5081787109375), (420.4161071777344, 629.5081787109375), (421.91400146484375, 629.5081787109375),(422.91265869140625, 629.5081787109375), (423.41192626953125, 629.5081787109375),(424.4105529785156, 629.5081787109375), (425.908447265625, 629.5081787109375),(426.40777587890625, 629.5081787109375), (427.4064025878906, 629.5081787109375), (428.4049987792969, 629.5081787109375), (429.40362548828125, 629.5081787109375)], 0.033000)
        post_action(0.000000)




    except Exception as e:

        print(e)

        traceback_str = ''.join(traceback.format_tb(e.__traceback__))

        print(traceback_str)

    os.system("adb shell am force-stop " + package_name)
    